<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>More Instant Messaging Interoperability (MIMI) message content</title>
<meta content="Rohan Mahy" name="author">
<meta content="
       This document describes content semantics common in Instant Messaging (IM)
systems and describes a profile suitable for instant messaging
interoperability of messages end-to-end encrypted inside the MLS
(Message Layer Security) Protocol. 
    " name="description">
<meta content="xml2rfc 3.28.1" name="generator">
<meta content="mimi" name="keyword">
<meta content="content" name="keyword">
<meta content="mls" name="keyword">
<meta content="mime" name="keyword">
<meta content="draft-ietf-mimi-content-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.28.1
    Python 3.12.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.0
    platformdirs 4.3.7
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-mimi-content.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MIMI Content</td>
<td class="right">April 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Mahy</td>
<td class="center">Expires 19 October 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">MIMI</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-mimi-content-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-04-17" class="published">17 April 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-10-19">19 October 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Mahy</div>
<div class="org">Rohan Mahy Consulting Services</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">More Instant Messaging Interoperability (MIMI) message content</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes content semantics common in Instant Messaging (IM)
systems and describes a profile suitable for instant messaging
interoperability of messages end-to-end encrypted inside the MLS
(Message Layer Security) Protocol.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 October 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-binary-encoding" class="internal xref">Binary encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-naming-schemes" class="internal xref">Naming schemes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-message-id" class="internal xref">Message ID</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-accepted-timestamp" class="internal xref">Accepted Timestamp</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-message-container" class="internal xref">Message Container</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-message-status-report" class="internal xref">Message Status Report</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-mimi-content-container-mess" class="internal xref">MIMI Content Container Message Semantics</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-message-behavior-fields" class="internal xref">Message Behavior Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-message-ordering" class="internal xref">Message Ordering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-extension-fields" class="internal xref">Extension Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-message-bodies" class="internal xref">Message Bodies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-external-content" class="internal xref">External content</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-derived-data-values" class="internal xref">Derived Data Values</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-original-message" class="internal xref">Original Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-reply" class="internal xref">Reply</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-reaction" class="internal xref">Reaction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-mentions" class="internal xref">Mentions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-edit" class="internal xref">Edit</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-delete" class="internal xref">Delete</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="auto internal xref">5.7</a>.  <a href="#name-unlike" class="internal xref">Unlike</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="auto internal xref">5.8</a>.  <a href="#name-expiring" class="internal xref">Expiring</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9">
                <p id="section-toc.1-1.5.2.9.1"><a href="#section-5.9" class="auto internal xref">5.9</a>.  <a href="#name-attachments" class="internal xref">Attachments</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.10">
                <p id="section-toc.1-1.5.2.10.1"><a href="#section-5.10" class="auto internal xref">5.10</a>. <a href="#name-conferencing" class="internal xref">Conferencing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.11">
                <p id="section-toc.1-1.5.2.11.1"><a href="#section-5.11" class="auto internal xref">5.11</a>. <a href="#name-topics-threading" class="internal xref">Topics / Threading</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-delivery-reporting-and-read" class="internal xref">Delivery Reporting and Read Receipts</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-delivery-report-example" class="internal xref">Delivery Report Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-support-for-specific-media-" class="internal xref">Support for Specific Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-mimi-required-and-recommend" class="internal xref">MIMI Required and Recommended media types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-specifics-of-github-flavore" class="internal xref">Specifics of Github Flavored Markdown in MIMI</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-use-of-proprietary-media-ty" class="internal xref">Use of proprietary media types</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-mime-subtype-registration-o" class="internal xref">MIME subtype registration of application/mimi-content</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-mime-subtype-registration-of" class="internal xref">MIME subtype registration of application/mimi-message-status</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-mimi-content-extension-keys" class="internal xref">MIMI Content Extension Keys registry</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#section-8.3.1" class="auto internal xref">8.3.1</a>.  <a href="#name-expert-review" class="internal xref">Expert Review</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-gfm-mimi-markdown-variant" class="internal xref">GFM-MIMI Markdown variant</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-general-handling" class="internal xref">General handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-generating-the-random-salt" class="internal xref">Generating the random salt</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-rendering-and-authorization" class="internal xref">Rendering and authorization of edits and deletes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-validation-of-timestamp" class="internal xref">Validation of timestamp</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-alternate-content-rendering" class="internal xref">Alternate content rendering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-link-and-mention-handling" class="internal xref">Link and Mention handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="auto internal xref">9.7</a>.  <a href="#name-delivery-and-read-receipts" class="internal xref">Delivery and Read Receipts</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-cddl-schemas" class="internal xref">CDDL Schemas</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-complete-message-format-sch" class="internal xref">Complete Message Format Schema</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-implied-message-fields" class="internal xref">Implied Message Fields</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-delivery-report-format" class="internal xref">Delivery Report Format</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-multipart-examples" class="internal xref">Multipart examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-proprietary-and-common-form" class="internal xref">Proprietary and Common formats sent as alternatives</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-multiple-reactions-example" class="internal xref">Multiple Reactions Example</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-complicated-nested-example" class="internal xref">Complicated Nested Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-changelog" class="internal xref">Changelog</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-C.1" class="auto internal xref">C.1</a>.  <a href="#name-changes-between-draft-mahy-" class="internal xref">Changes between draft-mahy-mimi-content-01 and draft-mahy-mimi-content-02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-C.2" class="auto internal xref">C.2</a>.  <a href="#name-changes-between-draft-mahy-m" class="internal xref">Changes between draft-mahy-mimi-content-02 and draft-ietf-mimi-content-00</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-C.3" class="auto internal xref">C.3</a>.  <a href="#name-changes-between-draft-ietf-" class="internal xref">Changes between draft-ietf-mimi-content-00 and draft-ietf-mimi-content-01</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#appendix-C.4" class="auto internal xref">C.4</a>.  <a href="#name-changes-between-draft-ietf-m" class="internal xref">Changes between draft-ietf-mimi-content-01 and draft-ietf-mimi-content-02</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#appendix-C.5" class="auto internal xref">C.5</a>.  <a href="#name-changes-between-draft-ietf-mi" class="internal xref">Changes between draft-ietf-mimi-content-02 and draft-ietf-mimi-content-03</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.6">
                <p id="section-toc.1-1.13.2.6.1"><a href="#appendix-C.6" class="auto internal xref">C.6</a>.  <a href="#name-changes-between-draft-ietf-mim" class="internal xref">Changes between draft-ietf-mimi-content-03 and draft-ietf-mimi-content-04</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.7">
                <p id="section-toc.1-1.13.2.7.1"><a href="#appendix-C.7" class="auto internal xref">C.7</a>.  <a href="#name-changes-between-draft-mahy-mi" class="internal xref">Changes between draft-mahy-mimi-content-04 and draft-mahy-mimi-content-05</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.8">
                <p id="section-toc.1-1.13.2.8.1"><a href="#appendix-C.8" class="auto internal xref">C.8</a>.  <a href="#name-changes-between-draft-mahy-mim" class="internal xref">Changes between draft-mahy-mimi-content-05 and draft-mahy-mimi-content-06</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="terminology">
<section id="section-1">
      <h2 id="name-terminology">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when,
and only when, they appear in all capitals, as shown here.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The terms MLS client, MLS group, and KeyPackage have the same meanings as in
the MLS protocol <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>. Other relevant terminology can be
found in <span>[<a href="#I-D.ietf-mimi-arch" class="cite xref">I-D.ietf-mimi-arch</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="introduction">
<section id="section-2">
      <h2 id="name-introduction">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-2-1">RFC EDITOR: PLEASE REMOVE THE FOLLOWING PARAGRAPH. The source for
this draft is maintained in GitHub. Suggested changes should be
submitted as pull requests at <a href="https://github.com/ietf-wg-mimi/draft-ietf-mimi-content">https://github.com/ietf-wg-mimi/draft-ietf-mimi-content</a>.
Editorial changes can be managed in GitHub, but any substantive
change should be discussed on the MIMI mailing list (mimi@ietf.org).<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">MLS <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> is a group key establishment protocol
motivated by the desire for group chat with efficient end-to-end encryption.
While one of the motivations of MLS is interoperable standards-based secure
messaging, the MLS protocol does not define or prescribe any format for the
encrypted "application messages" encoded by MLS.  The development of MLS
was strongly motivated by the needs of a number of Instant Messaging (IM)
systems, which encrypt messages end-to-end using variations of the
Double Ratchet protocol <span>[<a href="#DoubleRatchet" class="cite xref">DoubleRatchet</a>]</span>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">End-to-end encrypted instant messaging was also a motivator for the Common
Protocol for Instant Messaging (CPIM) <span>[<a href="#RFC3862" class="cite xref">RFC3862</a>]</span>, however the model used at the time
assumed standalone encryption of each message using a protocol such as S/MIME
<span>[<a href="#RFC8551" class="cite xref">RFC8551</a>]</span> or PGP <span>[<a href="#RFC3156" class="cite xref">RFC3156</a>]</span> to interoperate between IM protocols such as
SIP <span>[<a href="#RFC3261" class="cite xref">RFC3261</a>]</span> and XMPP <span>[<a href="#RFC6120" class="cite xref">RFC6120</a>]</span>.  For a variety of practical reasons, interoperable
end-to-end encryption between IM systems was never deployed commercially.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">There are now several instant messaging vendors implementing MLS, and the
MIMI (More Instant Messaging Interoperability) Working Group is chartered
to standardize an extensible interoperable messaging format for common
features to be conveyed "inside" MLS application messages.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">This document assumes that MLS clients advertise media types they support
and can determine what media types are required to join a
specific MLS group using the content advertisement extensions in Section 2.3 of
<span>[<a href="#I-D.ietf-mls-extensions" class="cite xref">I-D.ietf-mls-extensions</a>]</span>. It allows implementations to define MLS groups
with different media type requirements and allows MLS clients to send
extended or proprietary messages that would be interpreted by some members
of the group while assuring that an interoperable end-to-end encrypted
baseline is available to all members, even when the group spans multiple
systems or vendors.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Below is a list of some features commonly found in IM group chat systems:<a href="#section-2-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2-7.1">plain text and rich text messaging<a href="#section-2-7.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.2">mentions<a href="#section-2-7.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.3">replies<a href="#section-2-7.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.4">reactions<a href="#section-2-7.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.5">edit or delete previously sent messages<a href="#section-2-7.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.6">expiring messages<a href="#section-2-7.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.7">delivery notifications<a href="#section-2-7.7" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.8">read receipts<a href="#section-2-7.8" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.9">shared files/audio/videos<a href="#section-2-7.9" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.10">calling / conferencing<a href="#section-2-7.10" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-2-7.11">message threading<a href="#section-2-7.11" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<div id="binary-encoding">
<section id="section-3.1">
        <h3 id="name-binary-encoding">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-binary-encoding" class="section-name selfRef">Binary encoding</a>
        </h3>
<p id="section-3.1-1">The MIMI Content format is encoded in Concise Binary Object Representation
(CBOR) <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>. The Working Group chose a binary format in part because:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.1-2.1">we do not want to scan body parts to check for boundary marker
collisions. This rules out using multipart MIME types.<a href="#section-3.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.1-2.2">we do not want to base64 encode body parts with binary media
types (ex: images). This rules out using JSON to carry the binary data.<a href="#section-3.1-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-3">All examples start with an instance document annotated in the CBOR
Extended Diagnostic Notation (described in [Appendix G of @!RFC8610] and
more rigorously specified in <span>[<a href="#I-D.ietf-cbor-edn-literals" class="cite xref">I-D.ietf-cbor-edn-literals</a>]</span>), and then
include a hex dump of the CBOR data in the pretty printed format popularized
by the CBOR playground website (<a href="https://cbor.me">https://cbor.me</a>) with some minor whitespace
and comment reformatting. Finally, a message ID for the message is included
for most messages.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">All the instance documents validate using the CDDL schemas in Appendix B and
are included in the examples directory in the github repo for this document.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="naming-schemes">
<section id="section-3.2">
        <h3 id="name-naming-schemes">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-naming-schemes" class="section-name selfRef">Naming schemes</a>
        </h3>
<p id="section-3.2-1">IM systems have a number of types of identifiers. These are described in detail
in <span>[<a href="#I-D.mahy-mimi-identity" class="cite xref">I-D.mahy-mimi-identity</a>]</span>. A few of these used in this document are:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-2.1">handle identifier (external, friendly representation). This is the type
of identifier described later as the senderUserUrl in the examples, which
is analogous to the From header in email.<a href="#section-3.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-2.2">client/device identifier (internal representation). This is the type
of identifier described as the senderClientUrl in the examples.<a href="#section-3.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-2.3">group or room or conversation or channel name (either internal or external representation).
This is the type of identifier described as the MLS group URL in the examples.<a href="#section-3.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-3">This proposal relies on URIs for naming and identifiers. All the example use
the <code>im:</code> URI scheme (defined in <span>[<a href="#RFC3862" class="cite xref">RFC3862</a>]</span>), but any instant messaging scheme
could be used.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-id">
<section id="section-3.3">
        <h3 id="name-message-id">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-message-id" class="section-name selfRef">Message ID</a>
        </h3>
<p id="section-3.3-1">The MIMI content format relies heavily on message IDs to refer to other
messages, to reply, react, edit, delete, and report on the status of
messages. Every MIMI content message contains a 32-octet per-message
cryptographically random salt, and has a 32-octet message ID which is calculated
from the hash of the message (including the salt), the sender URI, and the
room URI.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Calculation of the message ID works as follows. The first octet of the MessageID
is the hash function ID from the
<a href="https://www.iana.org/assignments/named-information/named-information.xhtml#hash-alg">IANA hash algorithm registry</a>.
The sender URI, room URI, the entire MIMI message content (including
the salt), and the salt again are all concatenated, and then hashed with the
algorithm identified in the first octet. The first 31 octets of the hash_output
is appended to the hash function ID.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-3">
<pre>hash_output = hash( senderUri || roomUri || message || salt )
messageId = hashAlg || hash_output[0..30]

</pre><a href="#section-3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-3.3-4">The MIMI content format uses the SHA-256 hash algorithm (identifier 0x01) by
default, regardless of the hash algorithm of the cipher suite of a room's MLS
group. The initial octet allows the MIMI protocol to deprecate SHA-256 and
specify a new default algorithm in the future (for example if a practical
birthday attack on SHA_256 becomes feasible).<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<blockquote id="section-3.3-5">
          <p id="section-3.3-5.1">The salt is duplicated in the input to the hash to avoid a SHA-256 length
extension attack.<a href="#section-3.3-5.1" class="pilcrow">¶</a></p>
</blockquote>
</section>
</div>
<div id="accepted-timestamp">
<section id="section-3.4">
        <h3 id="name-accepted-timestamp">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-accepted-timestamp" class="section-name selfRef">Accepted Timestamp</a>
        </h3>
<p id="section-3.4-1">As described in the MIMI architecture <span>[<a href="#I-D.ietf-mimi-arch" class="cite xref">I-D.ietf-mimi-arch</a>]</span>, one
provider, called the hub, is responsible for ordering messages. The hub is
also responsible for recording the time that any application message is
accepted, and conveying it to any "follower" providers which receive messages
from the group. It is represented as the whole number of milliseconds since
the start of the UNIX epoch (01-Jan-1970 00:00:00 UTC). The accepted timestamp
MUST be available to each receiving MIMI client. The client can use it
for fine grain sorting of messages into a consistent order.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-container">
<section id="section-3.5">
        <h3 id="name-message-container">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-message-container" class="section-name selfRef">Message Container</a>
        </h3>
<p id="section-3.5-1">Most common instant messaging features are expressed as individual messages.
A plain or rich text message is obviously a message, but a reaction (ex: like),
a reply, editing a previous message, deleting an earlier message, and read
receipts are all typically modeled as another message with different properties.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">This document describes the semantics of a message container, which
can represent most of these previously mentioned message types.
The container typically carries one or more body parts with the actual message
content (for example, an emoji used in a reaction, a plain text or rich text
message or reply, a link, or an inline image).<a href="#section-3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-status-report">
<section id="section-3.6">
        <h3 id="name-message-status-report">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-message-status-report" class="section-name selfRef">Message Status Report</a>
        </h3>
<p id="section-3.6-1">This document also describes the semantics of a status report of other messages.
Because some messaging systems deliver messages in batches and allow a user to
mark several messages read at a time, the report format defined in <a href="#reporting" class="auto internal xref">Section 6</a>
allows a single report to convey the read/delivered status of multiple messages
(by message ID) within the same MLS group at a time.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="mimi-content-container-message-semantics">
<section id="section-4">
      <h2 id="name-mimi-content-container-mess">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-mimi-content-container-mess" class="section-name selfRef">MIMI Content Container Message Semantics</a>
      </h2>
<p id="section-4-1">Each MIMI Content message is a container format with two categories
of information:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4-2.1">the message behavior fields (which can have default or empty values), and<a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-4-2.2">the body part(s) and associated parameters<a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-3">The object fields in the structure defined below are numbered in
curly braces for reference in the text.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The subsections that follow contain snippets of Concise Data Definition
Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> schemas for the MIMI Content Container. The complete collected CDDL schema for MIMI Content Container is available in
<a href="#full-schema" class="auto internal xref">Appendix A.1</a>.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="message-behavior-fields">
<section id="section-4.1">
        <h3 id="name-message-behavior-fields">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-message-behavior-fields" class="section-name selfRef">Message Behavior Fields</a>
        </h3>
<div class="lang-cddl sourcecode" id="section-4.1-1">
<pre>mimiContent = [
  salt: bstr .size 16,
  replaces: null / MessageId,       ; {1}
  topicId: bstr,                    ; {2}
  expires: null / Expiration        ; {3}
  inReplyTo: null / InReplyTo,      ; {4}
  extensions: {* name =&gt; value },   ; {6}
  nestedPart: NestedPart            ; {7}
]

MessageId = bstr .size 32

</pre><a href="#section-4.1-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1-2">The first data field is the per-message unique salt which MUST be
cryptographically random. An example algorithm for generating the salt
is described in <a href="#salt-generation" class="auto internal xref">Section 9.2</a>.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The <code>replaces</code> {1} data field indicates that the current message
is a replacement or update to a previous message whose message ID
is in the <code>replaces</code> data field. It is used to edit previously-sent
messages, delete previously-sent messages, and adjust reactions to
messages to which the client previously reacted.
 If the <code>replaces</code> field is absent, the receiver
assumes that the current message has not identified any special
relationship with another previous message.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The <code>topicId</code> {2} data field indicates that the current message is
part of a logical grouping of messages which all share the same
value in the <code>topicId</code> data field. If the <code>topicId</code> is zero length,
there is no such grouping.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">The <code>expires</code> {3} data field is a hint from the sender to the receiver
that the message should be locally deleted and disregarded at either a specific
timestamp in the future, or a relative amount of time after the receiving client
reads the message. Indicate a message with no specific expiration
time with the value null. If non-null, the data field is an array of two items.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.1-6">
<pre>Expiration = [
    relative: bool,
    time: uint .size 4
]

</pre><a href="#section-4.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1-7">The first is a boolean indicating if the time is relative (true) or absolute
(false). The second is an unsigned integer. If relative, it is the whole number
of seconds the message should be visible before it is deleted. If absolute, it
is the number of seconds after the start of the UNIX epoch, at which point the
message should be deleted. Using an 32-bit unsigned integer allows expiration
dates until the year 2106. Note that specifying an expiration time provides no
assurance that the client actually honors or can honor the expiration time, nor
that the end user didn't otherwise save the expiring message (ex: via a
screenshot).<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">The <code>inReplyTo</code> {4} data field indicates that the current message is
a related continuation of another message sent in the same MLS group.
If present, it contains the message ID of the referenced message. Otherwise,
the receiver assumes that the current message has not identified any special
reply relationship with another previous message. The message id of the
referenced message is also used to make sure that a MIMI
message cannot refer to a sequence of referred messages which refers
back to itself. When replying, a client MUST NOT knowingly create a sequence
of replies which create a loop.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">When receiving a message with inReplyTo message, the client checks if the referenced message is itself inReplyTo another message. If so, it continues
following the referenced messages, checking that the message ID of none of the
referenced messages "loop" back to a message later in the inReplyTo chain.<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1-10">Note that a <code>inReplyTo</code>
always references a specific message ID. Even if the original message
was edited several times, a reply always refers to a specific version
of that message, and SHOULD refer to the most current version at the
time the reply is sent.<a href="#section-4.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-ordering">
<section id="section-4.2">
        <h3 id="name-message-ordering">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-message-ordering" class="section-name selfRef">Message Ordering</a>
        </h3>
<p id="section-4.2-1">Message ordering is provided by the Hub in the form of the accepted
timestamp. A malicious hub may be able to manipulate the order of
messages.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Imagine however that two users (Bob and Cathy) see a message from Alice
offering free Hawaiian pizza, and reply at the same time. Bob and Cathy both send
messages somehow referencing (Alice's)
message about pizza.  Their messages don't need to be replies or reactions.
Bob might just send a message saying he doesn't like pineapple on pizza.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">If clients want to detect messages sent out of order by the hub, they
require notification of message delivery at the MLS level (ex: the AppAck
mechanism provided in <span>[<a href="#I-D.ietf-mls-extensions" class="cite xref">I-D.ietf-mls-extensions</a>]</span>) or at the MIMI level,
such as the format defined in <a href="#reporting" class="auto internal xref">Section 6</a>.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extension-fields">
<section id="section-4.3">
        <h3 id="name-extension-fields">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-extension-fields" class="section-name selfRef">Extension Fields</a>
        </h3>
<p id="section-4.3-1">In order to add additional functionality to MIMI, senders can include
extension fields in the message format {6}. Each extension has a CBOR map key
which is a positive integer, negative integer, or text string containing between
1 and 255 octets of UTF-8. The value can be any CBOR (including combinations of maps and arrays) which can be represented in between 0 and 4096 octets.
The message content <code>extensions</code> field MUST NOT include more than one
extension field with the same map key.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.3-2">
<pre>name = int / tstr .size (1..255)
value = any .size (0..4095)

</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3-3">An IANA registry <a href="#keys-registry" class="auto internal xref">Section 8.3</a> is defined for
positive integer keys. Negative integer and text string keys are only for
private use.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-bodies">
<section id="section-4.4">
        <h3 id="name-message-bodies">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-message-bodies" class="section-name selfRef">Message Bodies</a>
        </h3>
<p id="section-4.4-1">Every MIMI content message has a body {7} which can have multiple,
possibly nested parts. A body with zero parts is permitted when
deleting or unliking. External body parts <a href="#external" class="auto internal xref">Section 4.5</a> are also supported.
When there is a single (inline) part or a (single) externally reference
part, its IANA media type, subtype, and parameters are included in the
contentType field {8}.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.4-2">
<pre>NestedPart = [
  disposition: baseDispos / $extDispos / unknownDispos,  ; {10}
  language: tstr,                                        ; {11}
  ( NullPart // SinglePart // ExternalPart // MultiPart)
]

NullPart = ( cardinality: nullpart )

SinglePart = (
    cardinality: single,
    contentType: tstr,        ; {8}
    content: bstr
)

ExternalPart = (
    cardinality: external,
    contentType: tstr,
    url: uri,
    expires: uint .size 4,
    size: uint .size 8,
    encAlg: uint .size 2,
    key: bstr,
    nonce: bstr,
    aad: bstr,
    hashAlg: uint .size 1,
    contentHash: bstr,
    description: tstr,
    filename: tstr
)

MultiPart = (
    cardinality: multi,
    partSemantics: chooseOne / singleUnit / processAll,
    parts: [2* NestedPart]
)

; cardinality
nullpart = 0
single   = 1
external = 2
multi    = 3

; part semantics {9}
chooseOne  = 0  ; receiver picks exactly one part to process
singleUnit = 1  ; receiver processes all parts as single unit
processAll = 2  ; receiver processes all parts individually

</pre><a href="#section-4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4-3">With some types of message content, there are multiple media types
associated with the same message which need to be rendered together,
for example a rich-text message with an inline image. With other
messages, there are multiple choices available for the same content,
for example a choice among multiple languages, or between two
different image formats. The relationship semantics among the parts
is specified as an enumeration {9}.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">The <code>chooseOne</code> part semantic is roughly analogous to the semantics of the
<code>multipart/alternative</code> media type, except that the ordering of the
nested body parts is merely a preference of the sender. The receiver
can choose the body part among those provided according to its own
policy.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5">The <code>singleUnit</code> part semantic is roughly analogous to the semantics
of the <code>multipart/related</code> media type, in that all the nested body
parts at this level are part of a single entity (for example, a
rich text message with an inline image). If the receiver does not
understand even one of the nested parts at this level, the receiver
should not process any of them.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">The <code>processAll</code> part semantic is roughly analogous to the semantics
of the <code>multipart/mixed</code> media type. The receiver should process as
many of the nested parts at this level as possible. For example, a
rich text document with a link, and a preview image of the link target
could be expressed using this semantic. Processing the preview image
is not strictly necessary for the correct rendering of the rich text
part.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<p id="section-4.4-7">The disposition {10} and language {11} of each part can be specified
for any part, including for nested parts. The disposition represents
the intended semantics of the body part or a set of nested parts.
It is inspired by the values in the Content-Disposition MIME header
<span>[<a href="#RFC2183" class="cite xref">RFC2183</a>]</span>.<a href="#section-4.4-7" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.4-8">
<pre>baseDispos = &amp;(
    unspecified: 0,
    render: 1,
    reaction: 2,
    profile: 3,
    inline: 4,
    icon: 5,
    attachment: 6,
    session: 7,
    preview: 8
)
; Note: any ext_dispos take precedence
unknownDispos = &amp;( unknown: 9..255 )

</pre><a href="#section-4.4-8" class="pilcrow">¶</a>
</div>
<p id="section-4.4-9">The <code>render</code> disposition means that the content should be rendered
according to local policy. The  <code>inline</code> dispositions means that the
content should be rendered "inline" directly in the chat interface.
The <code>attachment</code> disposition means that the content is intended to
be downloaded by the receiver instead of being rendered immediately.
The <code>reaction</code> disposition means that the content is a single
reaction to another message, typically an emoji, but which could be
an image, sound, or video. The <code>reaction</code> disposition was originally published
in <span>[<a href="#RFC9078" class="cite xref">RFC9078</a>]</span>, but was incorrectly placed in the Content Disposition
Parameters IANA registry instead of in the Content Disposition Values
registry.
The <code>session</code> disposition means that the content is a description of
a multimedia session, or a URI used to join one.
The <code>preview</code> disposition means that the content is a sender-generated
preview of something, such as the contents of a link.<a href="#section-4.4-9" class="pilcrow">¶</a></p>
<p id="section-4.4-10">The value of the language data field is an empty string or a
comma-separated list of one or more <code>Language-tag</code>s as defined
in <span>[<a href="#RFC5646" class="cite xref">RFC5646</a>]</span>.<a href="#section-4.4-10" class="pilcrow">¶</a></p>
<p id="section-4.4-11">Each part also has an implied part index, which is a zero-indexed,
depth-first integer. It is used to efficiently refer to a specific
body part (for example, an inline image) within another part. See
<a href="#nesting-example" class="auto internal xref">Appendix B.3</a> for an example of how the part index is
calculated.<a href="#section-4.4-11" class="pilcrow">¶</a></p>
<p id="section-4.4-12">The partIndex can be used inside a content ID URI <span>[<a href="#RFC2392" class="cite xref">RFC2392</a>]</span> in a "container"
part (for example HTML, Markdown, vCard <span>[<a href="#RFC6350" class="cite xref">RFC6350</a>]</span>, or iCal <span>[<a href="#RFC5545" class="cite xref">RFC5545</a>]</span>) to
reference another part inside the same MIMI message. In a MIMI message it has
the form <code>cid:</code><em>partIndex</em><code>@local.invalid</code>.
This format of the content ID URI in MIMI MUST only reference the <code>partIndex</code> of a SinglePart or ExternalPart.<a href="#section-4.4-12" class="pilcrow">¶</a></p>
<p id="section-4.4-13">When processing a MultiPart nested structure, the client can start from the
<code>body</code> in the MIMI content (the "top-level" or "root") and evaluate any
<code>chooseOne</code> semantics MultiPart elements, effectively discarding non-chosen
Parts. The remaining Parts might still reference each other in content ID URI.
To prevent processing a Part more than once, the client can handle the remaining
Parts in order, skipping any Parts already referenced by a previously handled
Part. This process of skipping already processed Parts is respected regardless
of the disposition of the Part.<a href="#section-4.4-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="external">
<section id="section-4.5">
        <h3 id="name-external-content">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-external-content" class="section-name selfRef">External content</a>
        </h3>
<p id="section-4.5-1">It is common in Instant Messaging systems to reference external
content via URI that will be processed automatically, either to
store bulky content (ex: videos, images, recorded sounds) outside
the messaging infrastructure, or to access a specific service URI,
for example, a media forwarding service for conferencing.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">An <code>ExternalPart</code> is a convenient way to reference this content. It
provides a similar function to the <code>message/external-body</code> media type.
It optionally includes the size of the data in octets (or zero if
the length is not provided). It also includes an optional timestamp
after which the external content is invalid, expressed as seconds
since the start of the UNIX epoch (01-Jan-1970), or zero if the
content does not expire.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.5-3">
<pre>ExternalPart = (
    cardinality: external,
    contentType: tstr,     ; An IANA media type {8}
    url: uri,              ; A URL where the content can be fetched
    expires: uint .size 4, ; expiration in seconds since UNIX epoch
    size: uint .size 8,    ; size of content in octets
    encAlg: uint .size 2,  ; An IANA AEAD Algorithm number, or zero
    key: bstr,             ; AEAD key
    nonce: bstr,           ; AEAD nonce
    aad: bstr,             ; AEAD additional authentiation data
    hashAlg: uint .size 1, ; An IANA Named Information Hash Algorithm
    contentHash: bstr,     ; hash of the content at the target url
    description: tstr,     ; an optional text description
    filename: tstr         ; an optional suggested filename
)

</pre><a href="#section-4.5-3" class="pilcrow">¶</a>
</div>
<p id="section-4.5-4">Typically, external content is encrypted with an ephemeral symmetric
key before it is uploaded, and whatever is necessary for decryption
is shared over the message channel.<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<p id="section-4.5-5">It is a matter of local policy to where the content is uploaded. Often
in federated messaging systems, the sender of the content stores the
external content in their own domain, but in some systems the content
is stored in the "owning" or "hub" domain of the MLS group.<a href="#section-4.5-5" class="pilcrow">¶</a></p>
<p id="section-4.5-6">Before being uploaded, private external content is encrypted with an
IANA-registered Authenticated Encryption with Additional Data (AEAD)
algorithm as described in <span>[<a href="#RFC5116" class="cite xref">RFC5116</a>]</span>. The key, nonce, and additional
authenticated data (aad) values are set to the values used during the
encryption. Unless modified by an extension, the default value of the
<code>aad</code> is empty.<a href="#section-4.5-6" class="pilcrow">¶</a></p>
<p id="section-4.5-7">If the external URL is a service, or the external content is not considered
private, the <code>encAlg</code> is set to zero, and the <code>key</code>, <code>nonce</code>, and <code>aad</code>
fields are zero length.<a href="#section-4.5-7" class="pilcrow">¶</a></p>
<p id="section-4.5-8">Implementations of this specification MUST implement the AES-128-GCM
algorithm.<a href="#section-4.5-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="derived-data-values">
<section id="section-4.6">
        <h3 id="name-derived-data-values">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-derived-data-values" class="section-name selfRef">Derived Data Values</a>
        </h3>
<p id="section-4.6-1">In addition to fields which are contained in a MIMI content message,
there is the hub accepted timestamp, which can be represented either
as milliseconds since the start of the UNIX epoch, or for future
extensibility as a CBOR extended time tag as defined in {{Section 3 of
!RFC9581}}. There are also two fields the implementation can definitely derive:
(the MLS group ID {12}, and the leaf index of the sender {13}). Many
implementations could also determine one or more of: the sender's client
identifier URL {14}, the user identifier URL of the credential associated
with the sender {15}, and the identifier URL for the MIMI room {16}.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.6-2">
<pre>MessageDerivedValues = [
    messageId: MessageId,
    hubAcceptedTimestamp: Timestamp,
    mlsGroupId: bstr,                  ; value always available {12}
    senderLeafIndex: uint .size 4,     ; value always available {13}
    senderClientUrl: uri               ; {14},
    senderUserUrl: uri,                ; "From" {15}
    roomUrl: uri                       ; "To"   {16}
]

MessageId = bstr .size 32
Timestamp = MsecsSinceEpoch / ExtendedTime
; milliseconds since start of UNIX epoch
MsecsSinceEpoch = uint .size 8
; extended time from RFC9581
ExtendedTime = #6.1001({* name =&gt; value })

</pre><a href="#section-4.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-5">
      <h2 id="name-examples">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-5-1">In the following examples, we assume that an MLS group is already established and
that either out-of-band or using the MLS protocol or MLS extensions, or
their client to provider protocol that the following is known to every
member of the group:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5-2.1">The membership of the group (via MLS).<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-5-2.2">The identity of any MLS client which sends an application message (via MLS).<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-5-2.3">The MLS group ID (via MLS)<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-5-2.4">The human-readable name(s) of the MIMI room, if any (out-of-band or extension).<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-5-2.5">Which media types are mandatory to implement (MLS content advertisement extensions).<a href="#section-5-2.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-5-2.6">For each member, the media types each supports (MLS content advertisement extensions).<a href="#section-5-2.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-3">Messages sent to an MLS group are delivered to every member of the group
active during the epoch in which the message was sent.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">All the examples start with a CBOR instance document annotated in the
Extended Diagnostic Format (described in [Appendix G of @!RFC8610] and more
rigorously specified in <span>[<a href="#I-D.ietf-cbor-edn-literals" class="cite xref">I-D.ietf-cbor-edn-literals</a>]</span>), and then include a
hex dump of the CBOR data in the pretty printed format popularized by the
CBOR playground website (<a href="https://cbor.me">https://cbor.me</a>) with some minor whitespace and
comment reformatting. Finally, a message ID for the message is included for
most messages.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">All the instance documents validate using the CDDL schemas in Appendix B and
are included in the examples directory in the github repo for this document.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="original-message">
<section id="section-5.1">
        <h3 id="name-original-message">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-original-message" class="section-name selfRef">Original Message</a>
        </h3>
<p id="section-5.1-1">In this example, Alice Smith sends a rich-text (Markdown) <span>[<a href="#RFC7763" class="cite xref">RFC7763</a>]</span>
message to the Engineering Team room. The following values are
derived from the client, except for the hub received timestamp, which
needs to be made available to the client by its provider:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.1-2.1">Sender MLS leaf index: 4<a href="#section-5.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.1-2.2">Sender MLS client ID URL:
mimi://example.com/d/3b52249d-68f9-45ce-8bf5-c799f3cad7ec/0003<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.1-2.3">MLS group ID:
7u4NEqe1tbeBFa0aHdsTgRyD_XOHxD5meZpZS-7aJr8<a href="#section-5.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.1-2.4">The MIMI room name: "Engineering Team"<a href="#section-5.1-2.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.1-2.5">The Hub received timestamp:
1644387225019 = 2022-02-09T06:13:45.019Z<a href="#section-5.1-2.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-3">Below is the message in annotated Extended Diagnostic Notation, and pretty
printed CBOR.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.1-4">
<pre># ORIGINAL
# message ID = h'010714238126772e253118df3cd18fa6
#                9f90841d7df1f6f0cddab1f0dc0c9a26'
# timestamp  = 1644387225019 = 2022-02-09T06:13:45.019Z
[
  h'5eed9406c2545547ab6f09f20a18b003', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires = never
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    1,                                   # cardinality = single part
    "text/markdown;variant=GFM-MIMI",    # contentType
                                         # content
    'Hi everyone, we just shipped release 2.0. __Good  work__!'
  ]
]

</pre><a href="#section-5.1-4" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.1-5">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      5eed9406c2545547ab6f09f20a18b003
   f6                                   # primitive(22)
   40                                   # bytes(0)
   f6                                   # primitive(22)
   f6                                   # primitive(22)
   a2                                   # map(2)
      01                                # unsigned(1)
      78 20                             # text(32)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f616c6963652d736d697468
         # "mimi://example.com/u/alice-smith"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   85                                   # array(5)
      01                                # unsigned(1)
      60                                # text(0)
                                        # ""
      01                                # unsigned(1)
      78 1e                             # text(30)
         746578742f6d61726b646f776e3b7661
         7269616e743d47464d2d4d494d49
         # "text/markdown;variant=GFM-MIMI"
      58 39                             # bytes(57)
         48692065766572796f6e652c20776520
         6a75737420736869707065642072656c
         6561736520322e302e205f5f476f6f64
         2020776f726b5f5f21
         # "Hi everyone, we just shipped release 2.0. __Good  work__!"

</pre><a href="#section-5.1-5" class="pilcrow">¶</a>
</div>
<p id="section-5.1-6">Below are the rest of the implied values for this message:<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.1-7">
<pre>[
  / messageId = Original message /
  h'010714238126772e253118df3cd18fa6
    9f90841d7df1f6f0cddab1f0dc0c9a26',

  / hubAcceptedTimestamp = 2022-02-08T22:13:45.019Z /
  1644387225019,

  / mlsGroupId /
  h'eeee0d12a7b5b5b78115ad1a1ddb1381
    1c83fd7387c43e66799a594beeda26bf',

  / senderLeafIndex /
  4,

  / senderClientUrl /
  "mimi://example.com/d/3b52249d-68f9-45ce-8bf5-c799f3cad7ec/0003",

  / senderUserUrl /
  "mimi://example.com/u/alice-smith",

  / roomUrl /
  "mimi://example.com/r/engineering_team"
]

</pre><a href="#section-5.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="reply">
<section id="section-5.2">
        <h3 id="name-reply">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-reply" class="section-name selfRef">Reply</a>
        </h3>
<p id="section-5.2-1">A reply message looks similar, but contains the message ID of the
original message in the <code>inReplyTo</code> data field. The derived MLS
group ID, URL, and name do not change in this example. The derived
senderClientId and senderLeafIndex are not especially relevant so
only the user handle URL, message ID, and hub received timestamp
are provided (in comments at the beginning of the annotated EDN).
The annotated EDN follows, then the pretty printed CBOR.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.2-2">
<pre># REPLY
# message ID = h'01efab9eca8374d3618a16b39c658689
#                fd90d07fe666a846178cb4965c94a8bf'
# timestamp  = 1644387237492 = 2022-02-09T06:13:57.492Z
[
  h'11a458c73b8dd2cf404db4b378b8fe4d', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/bob-jones",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    1,                                   # cardinality = single part
    "text/markdown;variant=GFM-MIMI",    # contentType
                                         # content
    'Right on! _Congratulations_ \'all!'
  ]
]

</pre><a href="#section-5.2-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.2-3">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      11a458c73b8dd2cf404db4b378b8fe4d
   f6                                   # primitive(22)
   40                                   # bytes(0)
   f6                                   # primitive(22)
   58 20                                # bytes(32)
      010714238126772e253118df3cd18fa6
      9f90841d7df1f6f0cddab1f0dc0c9a26
   a2                                   # map(2)
      01                                # unsigned(1)
      78 1e                             # text(30)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f626f622d6a6f6e6573
         # "mimi://example.com/u/bob-jones"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   85                                   # array(5)
      01                                # unsigned(1)
      60                                # text(0)
                                        # ""
      01                                # unsigned(1)
      78 1e                             # text(30)
         746578742f6d61726b646f776e3b7661
         7269616e743d47464d2d4d494d49
         # "text/markdown;variant=GFM-MIMI"
      58 21                             # bytes(33)
         5269676874206f6e21205f436f6e6772
         6174756c6174696f6e735f2027616c6c
         21
         # "Right on! _Congratulations_ 'all!"

</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="reaction">
<section id="section-5.3">
        <h3 id="name-reaction">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-reaction" class="section-name selfRef">Reaction</a>
        </h3>
<p id="section-5.3-1">A reaction looks like a reply, but uses the Disposition token of reaction. It is
modeled on the reaction Content-Disposition token defined in <span>[<a href="#RFC9078" class="cite xref">RFC9078</a>]</span>.
Both indicate that the intended disposition of the
contents of the message is a reaction.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">The content in the sample message is a single Unicode heart character (U+2665) which is expressed in UTF-8 as 0xe299a5.
Discovering the range of characters each implementation could render as a
reaction can occur out-of-band and is not within the scope of this proposal.
However, an implementation which receives a reaction character string it
does not recognize could render the reaction as a reply, possibly prefixing
with a localized string such as "Reaction: ".  Note that a reaction could
theoretically even be another media type (ex: image, audio, or video), although
not currently implemented in major instant messaging systems.
Note that many systems allow multiple independent reactions per sender.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">Below is the annotated message in EDN and pretty printed CBOR:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.3-4">
<pre># REACTION
# message ID = h'019ae2809946ea7f0337958c5c1c22e9
#                5013c211c09290358d3eb8fb3aa2d019'
# timestamp  = 1644387237728 = 2022-02-08T22:13:57.728Z
[
  h'd37bc0e6a8b4f04e9e6382375f587bf6', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/cathy-washington",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    2,                                   # disposition = reaction
    "",                                  # language
    1,                                   # cardinality = single
    "text/plain;charset=utf-8",          # contentType
    '❤'                                  # content = U+2665 (heart)
  ]
]

</pre><a href="#section-5.3-4" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.3-5">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      d37bc0e6a8b4f04e9e6382375f587bf6
   f6                                   # primitive(22)
   40                                   # bytes(0)
   f6                                   # primitive(22)
   58 20                                # bytes(32)
      010714238126772e253118df3cd18fa6
      9f90841d7df1f6f0cddab1f0dc0c9a26
   a2                                   # map(2)
      01                                # unsigned(1)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f63617468792d7761736869
         6e67746f6e
         # "mimi://example.com/u/cathy-washington"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   85                                   # array(5)
      02                                # unsigned(2)
      60                                # text(0)
                                        # ""
      01                                # unsigned(1)
      78 18                             # text(24)
         746578742f706c61696e3b6368617273
         65743d7574662d38
         # "text/plain;charset=utf-8"
      43                                # bytes(3)
         e29da4                         # "❤"

</pre><a href="#section-5.3-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mentions">
<section id="section-5.4">
        <h3 id="name-mentions">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-mentions" class="section-name selfRef">Mentions</a>
        </h3>
<p id="section-5.4-1">In instant messaging systems and social media, a mention allows special
formatting and behavior when a name, handle, or tag associated with a
known group is encountered, often when prefixed with a commercial-at "@"
character for mentions of users or a hash "#" character for groups or tags.
A message which contains a mention may trigger distinct notifications on
the IM client.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">We can convey a mention by linking the user handle URI, or group URI in Markdown
or HTML rich content. For example, a mention using Markdown is indicated below.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.4-3">
<pre># MENTION
# message ID = h'0103d50d4980c0a7a0990f65534ebd4f
#                0fa36b1f4680d6e080c19ea4a95def7b'
# timestamp  = 1644387243008 = 2022-02-08T22:14:03.008Z
[
  h'04f290e215d0f82d1750bfa8b7dc089d', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/cathy-washington",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    1,                                   # cardinality = single
    "text/markdown;variant=GFM-MIMI",    # contentType
                                         # content
    'Kudos to [@Alice Smith](mimi://example.com/u/alice-smith)' +
    ' for making the release happen!'
  ]
]

</pre><a href="#section-5.4-3" class="pilcrow">¶</a>
</div>
<p id="section-5.4-4">The same mention using HTML <span>[<a href="#W3C.CR-html52-20170808" class="cite xref">W3C.CR-html52-20170808</a>]</span> would instead
replace in the EDN the contentType and content indicated below.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.4-5">
<pre>  / ... /
  "text/html;charset=utf-8",
  '&lt;p&gt;Kudos to &lt;a href="mimi://example.com/u/alice-smith"&gt;' +
  '@Alice Smith&lt;/a&gt; for making the release happen!&lt;/p&gt;'

</pre><a href="#section-5.4-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="edit">
<section id="section-5.5">
        <h3 id="name-edit">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-edit" class="section-name selfRef">Edit</a>
        </h3>
<p id="section-5.5-1">Unlike with email messages, it is common in IM systems to allow the sender of
a message to edit or delete the message after the fact. Typically, the message
is replaced in the user interface of the receivers (even after the original
message is read) but shows a visual indication that it has been edited.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2">The <code>replaces</code> data field includes the message ID of the message to
edit/replace. The message included in the body is a replacement for the message
with the replaced message ID.<a href="#section-5.5-2" class="pilcrow">¶</a></p>
<p id="section-5.5-3">Here Bob Jones corrects a typo in his original message:<a href="#section-5.5-3" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.5-4">
<pre># EDIT
# message ID = h'0177ae58cfe751f18d7c89979ceabb0d
#                e701acb8daa2872bb353fa5f8aba1851'
# timestamp  = 1644387248621 = 2022-02-08T22:14:08.621Z
[
  h'b8c2e6d8800ecf45df39be6c45f4c042',  # salt
  h'01efab9eca8374d3618a16b39c658689    / replaces /
  fd90d07fe666a846178cb4965c94a8bf',    #   Reply
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/bob-jones",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    1,                                   # cardinality = single part
    "text/markdown;variant=GFM-MIMI",    # contentType
                                         # content
    'Right on! _Congratulations_ y\'all!'
  ]
]

</pre><a href="#section-5.5-4" class="pilcrow">¶</a>
</div>
<p id="section-5.5-5">Note that replies and reactions always refer to a specific message id,
and therefore a specific "version" of a message, which could have been
edited before and/or after the message id referenced in the reply or reaction.
It is a matter of local policy how to render (if at all) a reaction to
a subsequently edited message.<a href="#section-5.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delete">
<section id="section-5.6">
        <h3 id="name-delete">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-delete" class="section-name selfRef">Delete</a>
        </h3>
<p id="section-5.6-1">In IM systems, a delete means that the author of a specific message has
retracted the message, regardless if other users have read the message
or not. Typically, a placeholder remains in the user interface showing
that a message was deleted. Replies which reference a deleted message
typically hide the quoted portion and reflect that the original message
was deleted.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">If Bob deleted his message instead of modifying it, we would represent it
using the <code>replaces</code> data field, and using an empty body (NullPart),
as shown below.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.6-3">
<pre># DELETE
# message ID = h'01fb32968cf8c5fa00e6a45431d40aa8
#                ce4b7a92523b8bc69f3233e65023055f'
# timestamp  = 1644387248621 = 2022-02-08T22:14:08.621Z
[
  h'0a590d73b2c7761c39168be5ebf7f2e6', # salt
  h'01efab9eca8374d3618a16b39c658689    / replaces /
  fd90d07fe666a846178cb4965c94a8bf',    #   Reply
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/bob-jones",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    0,                                   # cardinality = null part
  ]
]

</pre><a href="#section-5.6-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="unlike">
<section id="section-5.7">
        <h3 id="name-unlike">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-unlike" class="section-name selfRef">Unlike</a>
        </h3>
<p id="section-5.7-1">In most IM systems, not only is it possible to react to a message ("Like"),
but it is possible to remove a previous reaction ("Unlike"). This can be
accomplished by deleting the message which creates the original reaction<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<p id="section-5.7-2">If Cathy removes her reaction, we would represent the removal using a
<code>replaces</code> data field with an empty body, referring to the message which
created the reaction, as shown below.<a href="#section-5.7-2" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.7-3">
<pre># UNLIKE
# message ID = h'01061e20fb16aad88bd75605df8387d4
#                fa444237451a05a72bb0f67037cc1669'
# timestamp  = 1644387250389 = 2022-02-08T22:14:10.389Z
[
  h'c5ba86dc9fd272e58ca52ec805b79199', # salt
  h'019ae2809946ea7f0337958c5c1c22e9   / replaces /
    5013c211c09290358d3eb8fb3aa2d019'  #   Reaction
  h'',                                 # topicId
  null,                                # expires
  h'010714238126772e253118df3cd18fa6   # inReplyTo =
    9f90841d7df1f6f0cddab1f0dc0c9a26', #   Original
  {                                    # extensions
    1: "mimi://example.com/u/cathy-washington",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    2,                                   # disposition = reaction
    "",                                  # language
    0,                                   # cardinality = null part
  ]
]

</pre><a href="#section-5.7-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="expiring">
<section id="section-5.8">
        <h3 id="name-expiring">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-expiring" class="section-name selfRef">Expiring</a>
        </h3>
<p id="section-5.8-1">There are two types of expiring messages in instant messaging systems. In the typical implementation, messages are deleted a specific amount of time relative to (after) when the receiving client reads the message. We will refer to this as
relative expiration.<a href="#section-5.8-1" class="pilcrow">¶</a></p>
<p id="section-5.8-2">Absolute expiring messages are designed to be deleted automatically by the
receiving client at a certain time whether they have been read or not.<a href="#section-5.8-2" class="pilcrow">¶</a></p>
<p id="section-5.8-3">As with manually deleted messages, there is no guarantee that an uncooperative
client or a determined user will not save the content of the message. The goal
instead is to allow cooperating client that respect the convention to signal
expiration times clearly.<a href="#section-5.8-3" class="pilcrow">¶</a></p>
<p id="section-5.8-4">The <code>expires</code> data field contains the absolute timestamp when, or relative
amount of time after reading, after which the message can be deleted.
The semantics of the header are that the message is automatically deleted
by the receiving clients at the indicated time without user interaction or
network connectivity necessary.<a href="#section-5.8-4" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.8-5">
<pre># EXPIRING
# message ID = h'0114e486b39d705e15e3000b57290de4
#                79affbda4ec2c1b17cc25c214229ed7d'
# timestamp  = 1644389403227 = 2022-02-08T22:49:06.227Z
[
  h'33be993eb39f418f9295afc2ae160d2d', # salt
  null,                                # replaces
  h'',                                 # topicId
  [                                    # expires
    false,                               # absolute, not relative
    1644390004,          # expires = 10 minutes after it was sent
  ]
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    1,                                   # disposition = render
    "",                                  # language
    1,                                   # cardinality = single part
    "text/markdown;variant=GFM-MIMI",    # contentType
                                         # content
    '__*VPN GOING DOWN*__ I\'m rebooting the VPN in ten minutes' +
    ' unless anyone objects.'
  ]
]

</pre><a href="#section-5.8-5" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.8-6">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      33be993eb39f418f9295afc2ae160d2d
   f6                                   # primitive(22)
   40                                   # bytes(0)
                                        # ""
   82                                   # array(2)
      f4                                # primitive(20)
      1a 62036674                       # unsigned(1644390004)
   f6                                   # primitive(22)
   a2                                   # map(2)
      01                                # unsigned(1)
      78 20                             # text(32)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f616c6963652d736d697468
         # "mimi://example.com/u/alice-smith"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   85                                   # array(5)
      01                                # unsigned(1)
      60                                # text(0)
                                        # ""
      01                                # unsigned(1)
      78 1e                             # text(30)
         746578742f6d61726b646f776e3b7661
         7269616e743d47464d2d4d494d49
         # "text/markdown;variant=GFM-MIMI"
      58 50                             # bytes(80)
         5f5f2a56504e20474f494e4720444f57
         4e2a5f5f2049276d207265626f6f7469
         6e67207468652056504e20696e207465
         6e206d696e7574657320756e6c657373
         20616e796f6e65206f626a656374732e
         # "__*VPN GOING DOWN*__ I'm rebooting the VPN in" +
         # " ten minutes unless anyone objects."

</pre><a href="#section-5.8-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="attachments">
<section id="section-5.9">
        <h3 id="name-attachments">
<a href="#section-5.9" class="section-number selfRef">5.9. </a><a href="#name-attachments" class="section-name selfRef">Attachments</a>
        </h3>
<p id="section-5.9-1">An ExternalPart is a convenient way to present both "attachments" and
(possibly inline rendered) content which is too large to be included
in an MLS application message. The disposition data
field is set to inline if the sender recommends inline rendering, or
attachment if the sender intends the content to be downloaded or
rendered separately.<a href="#section-5.9-1" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.9-2">
<pre># ATTACHMENT
# message ID = h'019536595b777ea2a133a4f362e78926
#                b6807c3eb7d519fbd9c5e1ad24c7cf5e'
# timestamp  = not specified in example
[
  h'18fac6371e4e53f1aeaf8a013155c166', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires = never
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/bob-jones",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    6,                                   # disposition = attachment
    "en",                                # language
    2,                                   # cardinality = external
    "video/mp4",                         # contentType
    # url
    "https://example.com/storage/8ksB4bSrrRE.mp4",
    0,                                   # expires
    708234961,                           # size
    1,                                   # encAlg = AES-128-GCM
    h'21399320958a6f4c745dde670d95e0d8', # key
    h'c86cf2c33f21527d1dd76f5b',         # nonce
    h'',                                 # aad
    1,                                   # hashAlg = sha256
    h'9ab17a8cf0890baaae7ee016c7312fcc   / content hash /
      080ba46498389458ee44f0276e783163',
    "2 hours of key signing video",      # description
    "bigfile.mp4"                        # filename
  ]
]

</pre><a href="#section-5.9-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.9-3">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      18fac6371e4e53f1aeaf8a013155c166
   f6                                   # primitive(22)
   40                                   # bytes(0)
                                        # ""
   f6                                   # primitive(22)
   f6                                   # primitive(22)
   a2                                   # map(2)
      01                                # unsigned(1)
      78 1e                             # text(30)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f626f622d6a6f6e6573
         # "mimi://example.com/u/bob-jones"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   8f                                   # array(15)
      06                                # unsigned(6)
      62                                # text(2)
         656e                           # "en"
      02                                # unsigned(2)
      69                                # text(9)
         766964656f2f6d7034             # "video/mp4"
      78 2b                             # text(43)
         68747470733a2f2f6578616d706c652e
         636f6d2f73746f726167652f386b7342
         346253727252452e6d7034
         # "https://example.com/storage/8ksB4bSrrRE.mp4"
      00                                # unsigned(0)
      1a 2a36ced1                       # unsigned(708234961)
      01                                # unsigned(1)
      50                                # bytes(16)
         21399320958a6f4c745dde670d95e0d8
      4c                                # bytes(12)
         c86cf2c33f21527d1dd76f5b
      40                                # bytes(0)
      01                                # unsigned(1)
      58 20                             # bytes(32)
         9ab17a8cf0890baaae7ee016c7312fcc
         080ba46498389458ee44f0276e783163
      78 1c                             # text(28)
         3220686f757273206f66206b65792073
         69676e696e6720766964656f
         # "2 hours of key signing video"
      6b                                # text(11)
         62696766696c652e6d7034         # "bigfile.mp4"

</pre><a href="#section-5.9-3" class="pilcrow">¶</a>
</div>
<p id="section-5.9-4">Other dispositions of external content are also possible, for example
an external GIF animation of a rocket ship could be used with a
reaction disposition.<a href="#section-5.9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conferencing">
<section id="section-5.10">
        <h3 id="name-conferencing">
<a href="#section-5.10" class="section-number selfRef">5.10. </a><a href="#name-conferencing" class="section-name selfRef">Conferencing</a>
        </h3>
<p id="section-5.10-1">Joining a conference via an external URL is possible. The link could be
rendered to the user, requiring a click. Alternatively the URL could be
in an ExternalPart with a disposition of <code>session</code>, which could be processed
differently by the client (for example, alerting the user or presenting
a dialog box).
Further discussion of calling and conferencing functionality is out-of-scope
of this document.<a href="#section-5.10-1" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="section-5.10-2">
<pre># CONFERENCING
# message ID = h'01c28cee525403a3a0d30e9958749790
#                42cd776051b3247a6ec3189e85804c02'
# timestamp  = not specified in example
[
  h'678ac6cd54de049c3e9665cd212470fa', # salt
  null,                                # replaces
  'Foo 118',                           # topicId
  null,                                # expires
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
    7,                                   # disposition = session
    "",                                  # language
    2,                                   # cardinality = external
    "",                                  # contentType
    "https://example.com/join/12345",    # url
    0,                                   # expires
    0,                                   # size
    0,                                   # encAlg = none
    h'',                                 # key
    h'',                                 # nonce
    h'',                                 # aad
    0,                                   # hashAlg = none
    h'',                                 # content hash
    "Join the Foo 118 conference",       # description
    ""                                   # filename
  ]
]

</pre><a href="#section-5.10-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-5.10-3">
<pre>87                                      # array(7)
   50                                   # bytes(16)
      678ac6cd54de049c3e9665cd212470fa
   f6                                   # primitive(22)
   47                                   # bytes(7)
      466f6f20313138                    # "Foo 118"
   f6                                   # primitive(22)
   f6                                   # primitive(22)
   a2                                   # map(2)
      01                                # unsigned(1)
      78 20                             # text(32)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f752f616c6963652d736d697468
         # "mimi://example.com/u/alice-smith"
      02                                # unsigned(2)
      78 25                             # text(37)
         6d696d693a2f2f6578616d706c652e63
         6f6d2f722f656e67696e656572696e67
         5f7465616d
         # "mimi://example.com/r/engineering_team"
   8f                                   # array(15)
      07                                # unsigned(7)
      60                                # text(0)
                                        # ""
      02                                # unsigned(2)
      60                                # text(0)
                                        # ""
      78 1e                             # text(30)
         68747470733a2f2f6578616d706c652e
         636f6d2f6a6f696e2f3132333435
         # "https://example.com/join/12345"
      00                                # unsigned(0)
      00                                # unsigned(0)
      00                                # unsigned(0)
      40                                # bytes(0)
                                        # ""
      40                                # bytes(0)
                                        # ""
      40                                # bytes(0)
                                        # ""
      00                                # unsigned(0)
      40                                # bytes(0)
                                        # ""
      78 1b                             # text(27)
         4a6f696e2074686520466f6f20313138
         20636f6e666572656e6365
         # "Join the Foo 118 conference"
      60                                # text(0)

</pre><a href="#section-5.10-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="topics-threading">
<section id="section-5.11">
        <h3 id="name-topics-threading">
<a href="#section-5.11" class="section-number selfRef">5.11. </a><a href="#name-topics-threading" class="section-name selfRef">Topics / Threading</a>
        </h3>
<p id="section-5.11-1">As popularized by the messaging application Slack, some messaging
applications have a notion of a Topic or message Thread
(not to be confused with message threading as used in email).
Clients beginning a new "topic" populate the <code>topicId</code> with a unique
opaque octet string. This could be the message ID of the first message
sent related to the topic. Subsequent messages may include the same
<code>topicId</code> for those messages to be associated with the same topic. The sort order
for messages within a thread uses the timestamp field. If more than
one message has the same timestamp, the lexically lowest message ID
sorts earlier.<a href="#section-5.11-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="reporting">
<section id="section-6">
      <h2 id="name-delivery-reporting-and-read">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-delivery-reporting-and-read" class="section-name selfRef">Delivery Reporting and Read Receipts</a>
      </h2>
<p id="section-6-1">In instant messaging systems, read receipts typically generate a distinct
indicator for each message. In some systems, the number of users in a group
who have read the message is subtly displayed and the list of users who
read the message is available on further inspection.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Of course, Internet mail has support for read receipts as well, but
the existing message disposition notification mechanism defined for email
in <span>[<a href="#RFC8098" class="cite xref">RFC8098</a>]</span> is completely inappropriate in this context:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-6-3.1">notifications can be sent by intermediaries<a href="#section-6-3.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-3.2">only one notification can be sent about a single message per recipient<a href="#section-6-3.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-3.3">a human-readable version of the notification is expected<a href="#section-6-3.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-3.4">each notification can refer to only one message<a href="#section-6-3.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-3.5">it is extremely verbose<a href="#section-6-3.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-4">Instead, we would like to be able to include status changes about multiple
messages in each report, the ability to mark a message delivered, then read, then unread, then expired
for example.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">The format below, application/mimi-message-status is sent
by one member of an MLS group to the entire group and can refer to multiple messages in that group.
The format contains a list of message ID / status pairs. As
the status at the recipient changes, the status can be updated in a subsequent notification.<a href="#section-6-5" class="pilcrow">¶</a></p>
<p id="section-6-6">The status of each message can be one of the following values:<a href="#section-6-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-6-7.1">0 (unread) indicates that the message was not yet read by the sender of the
report.<a href="#section-6-7.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.2">1 (delivered) indicates that a messaging client of the sender of the report
received the message.<a href="#section-6-7.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.3">2 (read) indicates that the sender of the report read the message.<a href="#section-6-7.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.4">3 (expired) indicates that the message expired and is not available for
reading. In the case of absolute expiration, it does not indicate if the message
was read before its expiry.<a href="#section-6-7.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.5">4 (deleted) indicates that the message was deleted, either by the local
client, or by another member of the room with the power to retract messages.<a href="#section-6-7.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.6">5 (hidden) indicates that the message was hidden by the local
client (for example archived).<a href="#section-6-7.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-7.7">6 (error) indicates that the sender client is aware of the message ID, but
that there was an unspecified error with the reception of the message.<a href="#section-6-7.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-8">Depending on the policy of the room and a potential sender of delivery reports,
sending delivery receipts and/or read receipt messages might be required,
optional, or forbidden.
Clients might also have policies about specific status values that are shared
and others which are not. Some status values might only be shared among the
reporting user's own clients, for example.<a href="#section-6-8" class="pilcrow">¶</a></p>
<p id="section-6-9">Below is the CDDL schema for message status.<a href="#section-6-9" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-6-10">
<pre>MessageStatusReport = [ * PerMessageStatus ]

PerMessageStatus = [
    messageId: MessageId,
    status: baseStatus / $extStatus / unknownStatus
]

baseStatus = &amp;(
    unread: 0,
    delivered: 1,
    read: 2,
    expired: 3,
    deleted: 4,
    hidden: 5,
    error: 6
)
unknownStatus = &amp;( unknown: 7..255 )

MessageId = bstr .size 32

</pre><a href="#section-6-10" class="pilcrow">¶</a>
</div>
<ul class="compact">
<li class="compact" id="section-6-11.1">Sender user handle URL:
mimi://example.com/u/bob-jones<a href="#section-6-11.1" class="pilcrow">¶</a>
</li>
      </ul>
<div id="delivery-report-example">
<section id="section-6.1">
        <h3 id="name-delivery-report-example">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-delivery-report-example" class="section-name selfRef">Delivery Report Example</a>
        </h3>
<div class="lang-edn sourcecode" id="section-6.1-1">
<pre>[
  [
    /  Original message     /
    h'010714238126772e253118df3cd18fa6
      9f90841d7df1f6f0cddab1f0dc0c9a26',
    2    / status = read    /
  ],
  [
    /  Reply message        /
    h'01efab9eca8374d3618a16b39c658689
      fd90d07fe666a846178cb4965c94a8bf',
    2    / status = read    /
  ],
  [
    /  Mention message      /
    h'0103d50d4980c0a7a0990f65534ebd4f
      0fa36b1f4680d6e080c19ea4a95def7b',
    0    / status = unread  /
  ],
  [
    /  Expiring message     /
    h'0114e486b39d705e15e3000b57290de4
      79affbda4ec2c1b17cc25c214229ed7d',
    3    / status = expired /
  ]
]

</pre><a href="#section-6.1-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-6.1-2">
<pre>84                                      # array(4)
   82                                   # array(2)
      58 20                             # bytes(32)
         d3c14744d1791d02548232c23d35efa9
         7668174ba385af066011e43bd7e51501
      02                                # unsigned(2)
   82                                   # array(2)
      58 20                             # bytes(32)
         e701beee59f9376282f39092e1041b2a
         c2e3aad1776570c1a28de244979c71ed
      02                                # unsigned(2)
   82                                   # array(2)
      58 20                             # bytes(32)
         6b50bfdd71edc83554ae21380080f4a3
         ba77985da34528a515fac3c38e4998b8
      00                                # unsigned(0)
   82                                   # array(2)
      58 20                             # bytes(32)
         5c95a4dfddab84348bcc265a479299fb
         d3a2eecfa3d490985da5113e5480c7f1
      03                                # unsigned(3)

</pre><a href="#section-6.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="support-for-specific-media-types">
<section id="section-7">
      <h2 id="name-support-for-specific-media-">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-support-for-specific-media-" class="section-name selfRef">Support for Specific Media Types</a>
      </h2>
<div id="mimi-required-and-recommended-media-types">
<section id="section-7.1">
        <h3 id="name-mimi-required-and-recommend">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-mimi-required-and-recommend" class="section-name selfRef">MIMI Required and Recommended media types</a>
        </h3>
<p id="section-7.1-1">As the MIMI Content container is just a container, the plain text or rich
text messages sent inside, and any image or other formats needs to be specified.
Clients compliant with MIMI MUST be able to receive the following media types:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.1-2.1">application/mimi-content -- the MIMI Content container format (described in this document)<a href="#section-7.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-2.2">text/plain;charset=utf-8<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-2.3">text/markdown;variant=GFM-MIMI -- Github Flavored Markdown for MIMI, defined in <a href="#gfm-mimi" class="auto internal xref">Section 7.1.1</a><a href="#section-7.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-3">Note that it is acceptable to render the contents of a received markdown
document as plain text.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">The following MIME types are RECOMMENDED:<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.1-5.1">text/markdown;variant=CommonMark -- <a href="https://spec.commonmark.org/0.30">CommonMark</a><a href="#section-7.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-5.2">text/html<a href="#section-7.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-5.3">application/mimi-message-status -- (described in this document)<a href="#section-7.1-5.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-5.4">image/jpeg<a href="#section-7.1-5.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-5.5">image/png<a href="#section-7.1-5.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-6">Clients compliant with this specification must be able to download
ExternalParts with <code>http</code> and <code>https</code> URLs, and decrypt downloaded content
encrypted with the AES-128-GCM AEAD algorithm.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<div id="gfm-mimi">
<section id="section-7.1.1">
          <h4 id="name-specifics-of-github-flavore">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-specifics-of-github-flavore" class="section-name selfRef">Specifics of Github Flavored Markdown in MIMI</a>
          </h4>
<p id="section-7.1.1-1">A MIMI content client supports GitHub Flavored Markdown as defined in <span>[<a href="#GFM" class="cite xref">GFM</a>]</span>,
with two changes: the Autolink extension is not supported; and instead of the
Disallowed Raw HTML extension (<code>tagfilter</code>), the No HTML extension (<code>nohtml</code>),
which is defined here, is MANDATORY. (For clarity, a fixed list of supported
extensions, is further described in the bullet points below.)<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1.1-2">To implement the No HTML extension to GFM, the opening angle bracket (<code>&lt;</code>) of
any <code>HTML tag</code> (as defined in Section 6.10 of <span>[<a href="#GFM" class="cite xref">GFM</a>]</span>) is replaced with <code>&amp;lt;</code>
before sending. Any <code>HTML tag</code> in a received message is rendered as plain text.
Note that <code>HTML tag</code> includes open tags, closing tags, HTML comments, processing
instructions, declarations, and CDATA sections.<a href="#section-7.1.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1.1-3">The following GitHub Flavored Markdown extensions are supported. No other extensions are allowed:<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.1.1-4.1">Tables<a href="#section-7.1.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-7.1.1-4.2">Task list items<a href="#section-7.1.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-7.1.1-4.3">Strikethrough<a href="#section-7.1.1-4.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-7.1.1-4.4">No HTML<a href="#section-7.1.1-4.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-7.1.1-5">This document specifies what can be sent inside a MIMI content message; it does
not restrict or prescribe in any way how input from a user is interpreted by an
Instant Messaging client that support MIMI, before any message resulting from
that input is sent.<a href="#section-7.1.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1.1-6">Note that rendering Markdown as plain text is an acceptable form of "support".<a href="#section-7.1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="use-of-proprietary-media-types">
<section id="section-7.2">
        <h3 id="name-use-of-proprietary-media-ty">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-use-of-proprietary-media-ty" class="section-name selfRef">Use of proprietary media types</a>
        </h3>
<p id="section-7.2-1">As most messaging systems are proprietary, standalone systems, it is useful to allow
clients to send and receive proprietary formats among themselves. Using the
functionality in the MIMI Content container, clients can send a message using the basic
functionality described in this document AND a proprietary format for
same-vendor clients simultaneously over the same group with end-to-end
encryption. An example is given in the Appendix.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">RFC EDITOR: Please replace XXXX throughout with the RFC number assigned to this document.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="mime-subtype-registration-of-application-mimi-content">
<section id="section-8.1">
        <h3 id="name-mime-subtype-registration-o">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-mime-subtype-registration-o" class="section-name selfRef">MIME subtype registration of application/mimi-content</a>
        </h3>
<p id="section-8.1-1">This document proposes registration of a media subtype with IANA.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.1-2">
<pre>Type name: application

Subtype name: mimi-content

Required parameters: none

Optional parameters: none

Encoding considerations:
   This message type should be encoded as binary data

Security considerations:
   See Section A of RFC XXXX

Interoperability considerations:
   See Section Y.Z of RFC XXXX

Published specification: RFC XXXX

Applications that use this media type:
   Instant Messaging Applications

Fragment identifier considerations: N/A

Additional information:

   Deprecated alias names for this type: N/A
   Magic number(s): N/A
   File extension(s): N/A
   Macintosh file type code(s): N/A

Person &amp; email address to contact for further information:
   IETF MIMI Working Group mimi@ietf.org



</pre><a href="#section-8.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mime-subtype-registration-of-application-mimi-message-status">
<section id="section-8.2">
        <h3 id="name-mime-subtype-registration-of">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-mime-subtype-registration-of" class="section-name selfRef">MIME subtype registration of application/mimi-message-status</a>
        </h3>
<p id="section-8.2-1">This document proposes registration of a media subtype with IANA.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2-2">
<pre>Type name: application

Subtype name: mimi-message-status

Required parameters: none

Optional parameters: none

Encoding considerations:
   This message type should be encoded as binary data

Security considerations:
   See Section A of RFC XXXX

Interoperability considerations:
   See Section Y.Z of RFC XXXX

Published specification: RFC XXXX

Applications that use this media type:
   Instant Messaging Applications

Fragment identifier considerations: N/A

Additional information:

   Deprecated alias names for this type: N/A
   Magic number(s): N/A
   File extension(s): N/A
   Macintosh file type code(s): N/A

Person &amp; email address to contact for further information:
   IETF MIMI Working Group mimi@ietf.org


</pre><a href="#section-8.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="keys-registry">
<section id="section-8.3">
        <h3 id="name-mimi-content-extension-keys">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-mimi-content-extension-keys" class="section-name selfRef">MIMI Content Extension Keys registry</a>
        </h3>
<p id="section-8.3-1">This document requests the creation of a new MIMI Content Extension Keys
registry.
The registry should be under the heading of "More Instant Messaging Interoperability (MIMI)".<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The MIMI Content format defined in this document, contains an extensions map in
each message. The keys in the extensions map can be (positive or negative)
integers, or text strings. Text strings and negative integer keys are reserved
for private use. Positive integer keys are assigned in the registry under the
Expert Review policy <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>. Integer keys between 1 and 255 are restricted
to IETF consensus specifications.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">The columns in the registry are as follows:<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.3-4.1">Key: The extension map key positive integer assigned to the MIMI content extension.<a href="#section-8.3-4.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.3-4.2">Name: a short descriptive name for the MIMI content extension.<a href="#section-8.3-4.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.3-4.3">Type: The CBOR data type of the value corresponding to the key. Applications
with multiple, related data items are encouraged to register a map type that
contains all the related fields.<a href="#section-8.3-4.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.3-4.4">
            <p id="section-8.3-4.4.1">Recommended: Whether support for this MIMI content extension is recommended by
the IETF. Valid values are "Y", "N", and "D", as described below. The default
value of the "Recommended" column is "N". Setting the Recommended item to "Y" or
"D", or changing an item whose current value is "Y" or "D", requires Standards
Action <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-8.3-4.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.3-4.4.2.1">Y: Indicates that the IETF has consensus, and that the item is
RECOMMENDED. This only means that the associated mechanism is fit for the
purpose for which it was defined. Careful reading of the documentation for the
mechanism is necessary to understand the applicability of that mechanism. The
IETF could recommend mechanisms that have limited applicability, but will
provide applicability statements that describe any limitations of the mechanism
or necessary constraints on its use.<a href="#section-8.3-4.4.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-8.3-4.4.2.2">N: Indicates that the item has not been evaluated by the IETF and that the
IETF has made no statement about the suitability of the associated mechanism.
This does not necessarily mean that the mechanism is flawed, only that no
consensus exists. The IETF might have consensus to leave an item marked as "N"
on the basis of it having limited applicability or usage constraints.<a href="#section-8.3-4.4.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-8.3-4.4.2.3">D: Indicates that the item is discouraged and SHOULD NOT or MUST NOT be
used. This marking could be used to identify mechanisms that might result in
problems if they are used, such as a weak cryptographic algorithm or a mechanism
that might cause interoperability problems in deployment.<a href="#section-8.3-4.4.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-8.3-4.5">Reference: The document where this MIMI content extension is defined<a href="#section-8.3-4.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.3-5">Initial Contents:<a href="#section-8.3-5" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Key</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">R</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">(reserved)</td>
              <td class="text-left" rowspan="1" colspan="1">N/A</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">RFCXXXX</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">sender_uri</td>
              <td class="text-left" rowspan="1" colspan="1">the sender as a MIMI participant</td>
              <td class="text-left" rowspan="1" colspan="1">tstr</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">RFCXXXX</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">room_uri</td>
              <td class="text-left" rowspan="1" colspan="1">the MIMI room URI</td>
              <td class="text-left" rowspan="1" colspan="1">tstr</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">RFCXXXX</td>
            </tr>
          </tbody>
        </table>
<div id="expert-review">
<section id="section-8.3.1">
          <h4 id="name-expert-review">
<a href="#section-8.3.1" class="section-number selfRef">8.3.1. </a><a href="#name-expert-review" class="section-name selfRef">Expert Review</a>
          </h4>
<p id="section-8.3.1-1">Expert Review <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> registry requests are registered
after a three-week review period on the MIMI Designated Expert (DE) mailing list
<a href="mailto:mimi-reg-review@ietf.org">mimi-reg-review@ietf.org</a> on the advice of one or more of the MIMI DEs.<a href="#section-8.3.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1-2">Registration requests sent to the MIMI DEs' mailing list for review
SHOULD use an appropriate subject (e.g., "Request to register value
in MIMI Content Extensions Keys registry").<a href="#section-8.3.1-2" class="pilcrow">¶</a></p>
<p id="section-8.3.1-3">Within the review period, the MIMI DEs will either approve or deny
the registration request, communicating this decision to the MIMI DEs'
mailing list and IANA. Denials SHOULD include an explanation and, if
applicable, suggestions as to how to make the request successful.
Registration requests that are undetermined for a period longer than
21 days can be brought to the IESG's attention for resolution using
the <a href="mailto:iesg@ietf.org">iesg@ietf.org</a> mailing list.<a href="#section-8.3.1-3" class="pilcrow">¶</a></p>
<p id="section-8.3.1-4">Criteria that SHOULD be applied by the MIMI DEs includes determining
whether the proposed registration duplicates existing functionality,
whether it is likely to be of general applicability or useful only
for a single application, and whether the registration description
is clear.<a href="#section-8.3.1-4" class="pilcrow">¶</a></p>
<p id="section-8.3.1-5">IANA MUST only accept registry updates from the MIMI DEs and SHOULD
direct all requests for registration to the MIMI DEs' mailing list.<a href="#section-8.3.1-5" class="pilcrow">¶</a></p>
<p id="section-8.3.1-6">In cases where a registration decision could be perceived as creating a conflict
of interest for a particular MIMI DE, that MIMI DE SHOULD defer to the judgment
of the other MIMI DEs.<a href="#section-8.3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="gfm-mimi-markdown-variant">
<section id="section-8.4">
        <h3 id="name-gfm-mimi-markdown-variant">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-gfm-mimi-markdown-variant" class="section-name selfRef">GFM-MIMI Markdown variant</a>
        </h3>
<p id="section-8.4-1">This document registers a new Markdown variant in the IANA Markdown Variants
registry. The registration template below conforms with <span>[<a href="#RFC7763" class="cite xref">RFC7763</a>]</span>.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.4-2">
<pre>Identifier: GFM-MIMI

Name: GitHub Flavored Markdown Subset for MIMI

Description:
   GitHub Flavored Markdown, without Autolinks and with no embedded HTML

References: RFCXXXX

Contact Information:
   IETF MIMI Working Group &lt;mimi@ietf.org&gt;

</pre><a href="#section-8.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="general-handling">
<section id="section-9.1">
        <h3 id="name-general-handling">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-general-handling" class="section-name selfRef">General handling</a>
        </h3>
<p id="section-9.1-1">The following cases are examples of nonsensical values that most likely
represent malicious messages. These should be logged and discarded.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.1">
            <p id="section-9.1-2.1.1">sender of the message<a href="#section-9.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.1.2.1">where the apparent sender is not a member of the target MLS group<a href="#section-9.1-2.1.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-2.2">
            <p id="section-9.1-2.2.1">message IDs<a href="#section-9.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.2.2.1">which duplicate another message ID already encountered<a href="#section-9.1-2.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.2.2.2">where the first octet of the message ID is an unknown hash algorithm.<a href="#section-9.1-2.2.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-2.3">
            <p id="section-9.1-2.3.1">timestamps<a href="#section-9.1-2.3.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.3.2.1">received more than a few minutes in the future, or<a href="#section-9.1-2.3.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.3.2.2">before the first concrete syntax of this document is published<a href="#section-9.1-2.3.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.3.2.3">before the room containing them was created<a href="#section-9.1-2.3.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-2.4">
            <p id="section-9.1-2.4.1">topicId<a href="#section-9.1-2.4.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.4.2.1">the <code>topicId</code> is very long (greater than 4096 octets)<a href="#section-9.1-2.4.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-2.5">
            <p id="section-9.1-2.5.1">expires<a href="#section-9.1-2.5.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.5.2.1">refers to a date more than a year in the past (only possible with absolute
expiration)<a href="#section-9.1-2.5.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.5.2.2">refers to a date more than a year in the future (possible with both
relative and absolute expiration)<a href="#section-9.1-2.5.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-2.6">
            <p id="section-9.1-2.6.1">body<a href="#section-9.1-2.6.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-2.6.2.1">has too many body parts (more than 1024)<a href="#section-9.1-2.6.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.6.2.2">is nested too deeply (more than 4 levels deep)<a href="#section-9.1-2.6.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.6.2.3">is too large (according to local policy)<a href="#section-9.1-2.6.2.3" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-2.6.2.4">has an unknown PartSemantics value<a href="#section-9.1-2.6.2.4" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-9.1-3">For the avoidance of doubt, the following cases may be examples of legitimate use
cases, and should not be considered the result of a malicious sender.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-4.1">
            <p id="section-9.1-4.1.1">message IDs<a href="#section-9.1-4.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-4.1.2.1">where <code>inReplyTo</code> or <code>replaces</code> refer to an unknown message.
Such a message could have been sent before the local client joined.<a href="#section-9.1-4.1.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-9.1-4.2">
            <p id="section-9.1-4.2.1">body<a href="#section-9.1-4.2.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.1-4.2.2.1">where a body part contains an unrecognized Disposition value. The
unknown value should be treated as if it where <code>render</code>.<a href="#section-9.1-4.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-4.2.2.2">where a contentType is unrecognized or unsupported.<a href="#section-9.1-4.2.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-9.1-4.2.2.3">where a language tag is unrecognized or unsupported.<a href="#section-9.1-4.2.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="salt-generation">
<section id="section-9.2">
        <h3 id="name-generating-the-random-salt">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-generating-the-random-salt" class="section-name selfRef">Generating the random salt</a>
        </h3>
<p id="section-9.2-1">To ensure a strong source of entropy for the per-message unique salt required in
each message, the client can export a secret from the MLS key schedule, for
example with the label <code>salt_base_secret</code> and calculate the salt as the HMAC of a locally generated nonce and the franking_base_secret.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.2-2">
<pre>salt = HMAC_SHA256( salt_base_secret, nonce )

</pre><a href="#section-9.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="rendering-and-authorization-of-edits-and-deletes">
<section id="section-9.3">
        <h3 id="name-rendering-and-authorization">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-rendering-and-authorization" class="section-name selfRef">Rendering and authorization of edits and deletes</a>
        </h3>
<p id="section-9.3-1">This content format allows clients to send new versions of previously sent
messages, effectively replacing ("editing") or retracting ("deleting") another
referenced message. The rendering of these "edits" and "deletes" are important
from a security perspective.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">For example, if Alice writes "Bob, could I borow a pen?", and Bob reacts with a
thumbs up emoji, Alice might edit this message with no change in meaning
(correcting the spelling of "borrow"), or a dramatic change in meaning ("Bob,
could I borrow your Ferrari this month?"). The receiver SHOULD indicate clearly
that a received message has been edited or retracted. The receiver might:<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.3-3.1">offer an option to view previous versions of a message,<a href="#section-9.3-3.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.3-3.2">show a summarized or thumbnail version of a message referenced in a reply,<a href="#section-9.3-3.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.3-3.3">indicate clearly that a reply was to a previous version of a message than the
most recent one.<a href="#section-9.3-3.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.3-3.4">show a detailed view of reaction indicating that some reactions referred to a
previous version of the message.<a href="#section-9.3-3.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.3-4">In addition, some groups may have special policies or permissions allowing
specific types of edits or deletes. For example, a moderator in one room might
be allowed to edit the topic of a message, but not modify the rest of the
content. An administrator might be allowed to delete messages which violate the
policy of the group. Receiving clients MUST NOT allow parties other than the
original sender of a message to edit or delete that message, unless there is a
specific, concrete authorization policy which allows it. Likewise, even the
original sender of a message MUST NOT be able to change the semantics of any
other portion of the message except for the contents of the NestedPart, without
specific authorization.<a href="#section-9.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validation-of-timestamp">
<section id="section-9.4">
        <h3 id="name-validation-of-timestamp">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-validation-of-timestamp" class="section-name selfRef">Validation of timestamp</a>
        </h3>
<p id="section-9.4-1">The timestamp is the time a message is accepted by the hub provider. As such,
the hub provider can manipulate the timestamp, and the sending provider
can delay sending messages selectively to cause the timestamp on a hub to
be later.
Note that the optional franking mechanism discussed in Section 5.4.1.2 of
<span>[<a href="#I-D.ietf-mimi-protocol" class="cite xref">I-D.ietf-mimi-protocol</a>]</span> prevents follower servers from modifying the
timestamp.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<blockquote id="section-9.4-2">
          <p id="section-9.4-2.1"><strong>TODO</strong>: Discuss how to sanity check lastSeen, timestamp and the MLS
epoch and generation, and the limitations of this approach.<a href="#section-9.4-2.1" class="pilcrow">¶</a></p>
</blockquote>
</section>
</div>
<div id="alternate-content-rendering">
<section id="section-9.5">
        <h3 id="name-alternate-content-rendering">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-alternate-content-rendering" class="section-name selfRef">Alternate content rendering</a>
        </h3>
<p id="section-9.5-1">This document includes a mechanism where the sender can offer alternate
versions of content in a single message. For example, the sender could
send:<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.5-2.1">an plain text and an HTML version of a text message<a href="#section-9.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.5-2.2">a thumbnail preview and link to a high-resolution image or video<a href="#section-9.5-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.5-2.3">versions of the same message in multiple languages<a href="#section-9.5-2.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.5-2.4">an PNG image and a scalable vector graphics version of a line drawing<a href="#section-9.5-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.5-3">A malicious client could use this mechanism to send content that will appear
different to a subset of the members of a group and possibly elicit an
incorrect or misleading response.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5-4">
<pre>Message as seen by Alice (manager)
Xavier: Do you want me to reserve a room for the review meeting?

Message as seen by Bob (Alice's assistant)
Xavier: @Bob I need to pickup Alice's Ferarri keys. She'll confirm

Reply sent by Alice
Alice: Yes please.

</pre><a href="#section-9.5-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="link-and-mention-handling">
<section id="section-9.6">
        <h3 id="name-link-and-mention-handling">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-link-and-mention-handling" class="section-name selfRef">Link and Mention handling</a>
        </h3>
<p id="section-9.6-1">Both Markdown and HTML support links. Using the example of an <code>https</code> link,
if the rendered text and the link target match exactly or are canonically
equivalent, there is no need for confirmation if the end user selects the link.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.6-2">
<pre>[example.com/foobar](https://example.com/foobar)
[https://example.com/foobar](https://example.com/foobar)
[https://example.com:443/foobar](https://example.com/foobar)

</pre><a href="#section-9.6-2" class="pilcrow">¶</a>
</div>
<p id="section-9.6-3">However, if the link text is different, or the scheme is downgraded
from https to http, the user should be presented with
an alert warning that the text is not the same.<a href="#section-9.6-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.6-4">
<pre>[https://example.com/foobar](https://spearphishers.example/foobar)
[https://example.com/foobar](http://example.com/foobar)

</pre><a href="#section-9.6-4" class="pilcrow">¶</a>
</div>
<p id="section-9.6-5">An IM URI link to a user who has a member client in the MLS
group in which the message was sent is considered a mention. Clients may
support special rendering of mentions instead of treating them like any
other type of link. In Markdown and HTML, the display text portion of a
link is considered a rendering hint from the sender to the receiver of
the message. The receiver should use local policy to decide if the hint
is an acceptable local representation of the user represented by the link
itself. If the hint is not an acceptable representation, the client should
instead display its canonical representation for the user.<a href="#section-9.6-5" class="pilcrow">¶</a></p>
<p id="section-9.6-6">For example, in the first example, the sender expresses no preference
about how to render the mention. In the second example, the sender requests
that the mention is rendered as the literal URI. In the third example, the
sender requests the canonical handle for Alice. In the fourth example, the
sender requests Alice's first name.<a href="#section-9.6-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.6-7">
<pre>&lt;mimi://example.com/u/alice-smith&gt;
[mimi://example.com/u/alice-smith](mimi://example.com/u/alice-smith)
[@AliceSmith](mimi://example.com/u/alice-smith)
[Alice](mimi://example.com/u/alice-smith)

</pre><a href="#section-9.6-7" class="pilcrow">¶</a>
</div>
<p id="section-9.6-8">Note that in some clients, presence of a mention for the local user may
result in a different notification policy.<a href="#section-9.6-8" class="pilcrow">¶</a></p>
<p id="section-9.6-9">If the client does not support special rendering of mentions, the
application, should render the text like any other link.<a href="#section-9.6-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delivery-and-read-receipts">
<section id="section-9.7">
        <h3 id="name-delivery-and-read-receipts">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-delivery-and-read-receipts" class="section-name selfRef">Delivery and Read Receipts</a>
        </h3>
<p id="section-9.7-1">Delivery and Read Receipts can provide useful information inside a group,
or they can reveal sensitive private information. In many IM systems
there is are per-group policies for and/or delivery read receipts:<a href="#section-9.7-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-9.7-2.1">they are required<a href="#section-9.7-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.7-2.2">they are permitted, but optional<a href="#section-9.7-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-9.7-2.3">they are forbidden<a href="#section-9.7-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.7-3">In the first case, everyone in the group would have to claim to support
read receipts to be in the group and agree to the policy of sending them
whenever a message was read. A user who did not wish to send read receipts could
review the policy (automatically or manually) and choose not to join
the group. Of course, requiring read receipts is a cooperative effort
just like using self-deleting messages. A malicious client could obviously
read a message and not send a read receipt, or send a read receipt for a
message that was never rendered. However, cooperating clients have a way to
agree that they will send read receipts when a message is read in a specific
group.<a href="#section-9.7-3" class="pilcrow">¶</a></p>
<p id="section-9.7-4">In the second case, sending a read receipt would be at the discretion
of each receiver of the message (via local preferences).<a href="#section-9.7-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="GFM">[GFM]</dt>
        <dd>
<span class="refAuthor">GitHub</span>, <span class="refTitle">"GitHub Flavored Markdown Spec, Version 0.29-gfm"</span>, <time datetime="2019-03-06" class="refDate">6 March 2019</time>, <span>&lt;<a href="https://github.github.com/gfm/">https://github.github.com/gfm/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2392">[RFC2392]</dt>
        <dd>
<span class="refAuthor">Levinson, E.</span>, <span class="refTitle">"Content-ID and Message-ID Uniform Resource Locators"</span>, <span class="seriesInfo">RFC 2392</span>, <span class="seriesInfo">DOI 10.17487/RFC2392</span>, <time datetime="1998-08" class="refDate">August 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2392">https://www.rfc-editor.org/info/rfc2392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3862">[RFC3862]</dt>
        <dd>
<span class="refAuthor">Klyne, G.</span> and <span class="refAuthor">D. Atkins</span>, <span class="refTitle">"Common Presence and Instant Messaging (CPIM): Message Format"</span>, <span class="seriesInfo">RFC 3862</span>, <span class="seriesInfo">DOI 10.17487/RFC3862</span>, <time datetime="2004-08" class="refDate">August 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3862">https://www.rfc-editor.org/info/rfc3862</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5646">[RFC5646]</dt>
        <dd>
<span class="refAuthor">Phillips, A., Ed.</span> and <span class="refAuthor">M. Davis, Ed.</span>, <span class="refTitle">"Tags for Identifying Languages"</span>, <span class="seriesInfo">BCP 47</span>, <span class="seriesInfo">RFC 5646</span>, <span class="seriesInfo">DOI 10.17487/RFC5646</span>, <time datetime="2009-09" class="refDate">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5646">https://www.rfc-editor.org/info/rfc5646</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9420">[RFC9420]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="seriesInfo">RFC 9420</span>, <span class="seriesInfo">DOI 10.17487/RFC9420</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9420">https://www.rfc-editor.org/info/rfc9420</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="W3C.CR-html52-20170808">[W3C.CR-html52-20170808]</dt>
      <dd>
<span class="refAuthor">Faulkner, S.</span>, <span class="refAuthor">Eicholz, A.</span>, <span class="refAuthor">Leithead, T.</span>, <span class="refAuthor">Danilo, A.</span>, and <span class="refAuthor">S. Moon</span>, <span class="refTitle">"HTML 5.2"</span>, <span class="seriesInfo">World Wide Web Consortium CR CR-html52-20170808</span>, <time datetime="2017-08-08" class="refDate">8 August 2017</time>, <span>&lt;<a href="https://www.w3.org/TR/2017/CR-html52-20170808">https://www.w3.org/TR/2017/CR-html52-20170808</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="DoubleRatchet">[DoubleRatchet]</dt>
        <dd>
<span class="refAuthor">Perrin, T.</span> and <span class="refAuthor">M. Marlinspike</span>, <span class="refTitle">"The Double Ratchet Algorithm"</span>, <time datetime="2016-11-20" class="refDate">20 November 2016</time>, <span>&lt;<a href="https://signal.org/docs/specifications/doubleratchet/">https://signal.org/docs/specifications/doubleratchet/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cbor-edn-literals">[I-D.ietf-cbor-edn-literals]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"CBOR Extended Diagnostic Notation (EDN)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cbor-edn-literals-16</span>, <time datetime="2025-01-08" class="refDate">8 January 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cbor-edn-literals-16">https://datatracker.ietf.org/doc/html/draft-ietf-cbor-edn-literals-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-mimi-arch">[I-D.ietf-mimi-arch]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refTitle">"An Architecture for More Instant Messaging Interoperability (MIMI)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mimi-arch-01</span>, <time datetime="2024-11-21" class="refDate">21 November 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mimi-arch-01">https://datatracker.ietf.org/doc/html/draft-ietf-mimi-arch-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-mimi-protocol">[I-D.ietf-mimi-protocol]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Hodgson, M.</span>, <span class="refAuthor">Kohbrok, K.</span>, <span class="refAuthor">Mahy, R.</span>, <span class="refAuthor">Ralston, T.</span>, and <span class="refAuthor">R. Robert</span>, <span class="refTitle">"More Instant Messaging Interoperability (MIMI) using HTTPS and MLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mimi-protocol-03</span>, <time datetime="2025-03-03" class="refDate">3 March 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mimi-protocol-03">https://datatracker.ietf.org/doc/html/draft-ietf-mimi-protocol-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-mls-extensions">[I-D.ietf-mls-extensions]</dt>
        <dd>
<span class="refAuthor">Robert, R.</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Extensions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mls-extensions-06</span>, <time datetime="2025-02-19" class="refDate">19 February 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mls-extensions-06">https://datatracker.ietf.org/doc/html/draft-ietf-mls-extensions-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.mahy-mimi-identity">[I-D.mahy-mimi-identity]</dt>
        <dd>
<span class="refAuthor">Mahy, R.</span>, <span class="refTitle">"More Instant Messaging Interoperability (MIMI) Identity Concepts"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-mahy-mimi-identity-03</span>, <time datetime="2025-03-03" class="refDate">3 March 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-mahy-mimi-identity-03">https://datatracker.ietf.org/doc/html/draft-mahy-mimi-identity-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2046">[RFC2046]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span> and <span class="refAuthor">N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types"</span>, <span class="seriesInfo">RFC 2046</span>, <span class="seriesInfo">DOI 10.17487/RFC2046</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2046">https://www.rfc-editor.org/info/rfc2046</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2183">[RFC2183]</dt>
        <dd>
<span class="refAuthor">Troost, R.</span>, <span class="refAuthor">Dorner, S.</span>, and <span class="refAuthor">K. Moore, Ed.</span>, <span class="refTitle">"Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field"</span>, <span class="seriesInfo">RFC 2183</span>, <span class="seriesInfo">DOI 10.17487/RFC2183</span>, <time datetime="1997-08" class="refDate">August 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2183">https://www.rfc-editor.org/info/rfc2183</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3156">[RFC3156]</dt>
        <dd>
<span class="refAuthor">Elkins, M.</span>, <span class="refAuthor">Del Torto, D.</span>, <span class="refAuthor">Levien, R.</span>, and <span class="refAuthor">T. Roessler</span>, <span class="refTitle">"MIME Security with OpenPGP"</span>, <span class="seriesInfo">RFC 3156</span>, <span class="seriesInfo">DOI 10.17487/RFC3156</span>, <time datetime="2001-08" class="refDate">August 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3156">https://www.rfc-editor.org/info/rfc3156</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3261">[RFC3261]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span>, <span class="refAuthor">Schulzrinne, H.</span>, <span class="refAuthor">Camarillo, G.</span>, <span class="refAuthor">Johnston, A.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Sparks, R.</span>, <span class="refAuthor">Handley, M.</span>, and <span class="refAuthor">E. Schooler</span>, <span class="refTitle">"SIP: Session Initiation Protocol"</span>, <span class="seriesInfo">RFC 3261</span>, <span class="seriesInfo">DOI 10.17487/RFC3261</span>, <time datetime="2002-06" class="refDate">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3261">https://www.rfc-editor.org/info/rfc3261</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5545">[RFC5545]</dt>
        <dd>
<span class="refAuthor">Desruisseaux, B., Ed.</span>, <span class="refTitle">"Internet Calendaring and Scheduling Core Object Specification (iCalendar)"</span>, <span class="seriesInfo">RFC 5545</span>, <span class="seriesInfo">DOI 10.17487/RFC5545</span>, <time datetime="2009-09" class="refDate">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5545">https://www.rfc-editor.org/info/rfc5545</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6120">[RFC6120]</dt>
        <dd>
<span class="refAuthor">Saint-Andre, P.</span>, <span class="refTitle">"Extensible Messaging and Presence Protocol (XMPP): Core"</span>, <span class="seriesInfo">RFC 6120</span>, <span class="seriesInfo">DOI 10.17487/RFC6120</span>, <time datetime="2011-03" class="refDate">March 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6120">https://www.rfc-editor.org/info/rfc6120</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6350">[RFC6350]</dt>
        <dd>
<span class="refAuthor">Perreault, S.</span>, <span class="refTitle">"vCard Format Specification"</span>, <span class="seriesInfo">RFC 6350</span>, <span class="seriesInfo">DOI 10.17487/RFC6350</span>, <time datetime="2011-08" class="refDate">August 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6350">https://www.rfc-editor.org/info/rfc6350</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7763">[RFC7763]</dt>
        <dd>
<span class="refAuthor">Leonard, S.</span>, <span class="refTitle">"The text/markdown Media Type"</span>, <span class="seriesInfo">RFC 7763</span>, <span class="seriesInfo">DOI 10.17487/RFC7763</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7763">https://www.rfc-editor.org/info/rfc7763</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8098">[RFC8098]</dt>
        <dd>
<span class="refAuthor">Hansen, T., Ed.</span> and <span class="refAuthor">A. Melnikov, Ed.</span>, <span class="refTitle">"Message Disposition Notification"</span>, <span class="seriesInfo">STD 85</span>, <span class="seriesInfo">RFC 8098</span>, <span class="seriesInfo">DOI 10.17487/RFC8098</span>, <time datetime="2017-02" class="refDate">February 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8098">https://www.rfc-editor.org/info/rfc8098</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8551">[RFC8551]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refAuthor">Ramsdell, B.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9078">[RFC9078]</dt>
      <dd>
<span class="refAuthor">Crocker, D.</span>, <span class="refAuthor">Signes, R.</span>, and <span class="refAuthor">N. Freed</span>, <span class="refTitle">"Reaction: Indicating Summary Reaction to a Message"</span>, <span class="seriesInfo">RFC 9078</span>, <span class="seriesInfo">DOI 10.17487/RFC9078</span>, <time datetime="2021-08" class="refDate">August 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9078">https://www.rfc-editor.org/info/rfc9078</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="cddl-schemas">
<section id="appendix-A">
      <h2 id="name-cddl-schemas">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-cddl-schemas" class="section-name selfRef">CDDL Schemas</a>
      </h2>
<p id="appendix-A-1">Below are Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> schemas for
the formats described in the body of the document.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="full-schema">
<section id="appendix-A.1">
        <h3 id="name-complete-message-format-sch">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-complete-message-format-sch" class="section-name selfRef">Complete Message Format Schema</a>
        </h3>
<div class="breakable lang-cddl sourcecode" id="appendix-A.1-1">
<pre>mimiContent = [
  salt: bstr .size 16,
  replaces: null / MessageId,
  topicId: bstr,
  expires: null / Expiration,
  inReplyTo: null / MessageId,
  extensions: {* name =&gt; value },
  nestedPart: NestedPart
]

NestedPart = [
  disposition: baseDispos / $extDispos / unknownDispos,
  language: tstr,
  ( NullPart // SinglePart // ExternalPart // MultiPart)
]

NullPart = ( cardinality: nullpart )

SinglePart = (
    cardinality: single,
    contentType: tstr,
    content: bstr
)

ExternalPart = (
    cardinality: external,
    contentType: tstr,
    url: tstr,
    expires: uint .size 4,
    size: uint .size 8,
    encAlg: uint .size 2,
    key: bstr,
    nonce: bstr,
    aad: bstr,
    hashAlg: uint .size 1,
    contentHash: bstr,
    description: tstr,
    filename: tstr
)

MultiPart = (
    cardinality: multi,
    partSemantics: chooseOne / singleUnit / processAll,
    parts: [2* NestedPart]
)

Expiration = [
    relative: bool,
    time: uint .size 4
]

baseDispos = &amp;(
    unspecified: 0,
    render: 1,
    reaction: 2,
    profile: 3,
    inline: 4,
    icon: 5,
    attachment: 6,
    session: 7,
    preview: 8
)
; Note: any ext_dispos take precedence
unknownDispos = &amp;( unknown: 9..255 )

; MessageId is derived from SHA256 hash
MessageId = bstr .size 32

name = int / tstr .size (1..255)
value = any .size (0..4095)

nullpart = 0
single   = 1
external = 2
multi    = 3

chooseOne  = 0
singleUnit = 1
processAll = 2

</pre><a href="#appendix-A.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="implied-message-fields">
<section id="appendix-A.2">
        <h3 id="name-implied-message-fields">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-implied-message-fields" class="section-name selfRef">Implied Message Fields</a>
        </h3>
<p id="appendix-A.2-1">Below is a CDDL schema for the implied message fields.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="appendix-A.2-2">
<pre>MessageDerivedValues = [
    messageId: MessageId,
    hubAcceptedTimestamp: Timestamp,
    mlsGroupId: bstr,
    senderLeafIndex: uint .size 4,
    senderClientUrl: MsgUri,
    senderUserUrl: MsgUri,
    roomUrl: MsgUri
]

MsgUri = tstr
MessageId = bstr .size 32
Timestamp = MsecsSinceEpoch / ExtendedTime
; milliseconds since start of UNIX epoch
MsecsSinceEpoch = uint .size 8
; extended time from RFC9581
ExtendedTime = #6.1001({* name =&gt; value })
name = int / tstr .size (1..255)
value = any .size (0..4095)

</pre><a href="#appendix-A.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="delivery-report-format">
<section id="appendix-A.3">
        <h3 id="name-delivery-report-format">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-delivery-report-format" class="section-name selfRef">Delivery Report Format</a>
        </h3>
<div class="lang-cddl sourcecode" id="appendix-A.3-1">
<pre>MessageStatusReport = [ * PerMessageStatus ]

PerMessageStatus = [
    messageId: MessageId,
    status: baseStatus / $extStatus / unknownStatus
]

baseStatus = &amp;(
    unread: 0,
    delivered: 1,
    read: 2,
    expired: 3,
    deleted: 4,
    hidden: 5,
    error: 6
)
unknownStatus = &amp;( unknown: 7..255 )

MessageId = bstr .size 32

</pre><a href="#appendix-A.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="multipart-examples">
<section id="appendix-B">
      <h2 id="name-multipart-examples">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-multipart-examples" class="section-name selfRef">Multipart examples</a>
      </h2>
<p id="appendix-B-1">In a heterogeneous group of IM clients, it is often desirable to send more than one
media type as alternatives, such that IM clients have a choice of which media
type to render. For example, imagine an IM group containing a set of clients
which support a common video format and a subset which only support animated GIFs.
The sender could use a <code>MultiPart</code> NestablePart with <code>chooseOne</code> semantics
containing both media types. Every client in the group chat could render something
resembling the media sent. This is analogous to the <code>multipart/alternative</code> <span>[<a href="#RFC2046" class="cite xref">RFC2046</a>]</span>
media type.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Likewise, it is often desirable to send more than one media type intended to be
rendered together as in (for example a rich text document with embedded images),
which can be represented using a <code>MultiPart</code> NestablePart with <code>processAll</code>
semantics. This is analogous to the <code>multipart/mixed</code> <span>[<a href="#RFC2046" class="cite xref">RFC2046</a>]</span> media type.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">Note that there is a minor semantic difference between multipart/alternative and
<code>MultiPart</code> with <code>chooseOne</code> semantics. In multipart/alternative, the parts are
presented in preference order by the sender. With <code>MultiPart</code> the receiver
chooses its "best" format to render according to its own preferences.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<div id="proprietary-and-common-formats-sent-as-alternatives">
<section id="appendix-B.1">
        <h3 id="name-proprietary-and-common-form">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-proprietary-and-common-form" class="section-name selfRef">Proprietary and Common formats sent as alternatives</a>
        </h3>
<p id="appendix-B.1-1">This shows sending a message containing both this profile and a proprietary
messaging format simultaneously.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="appendix-B.1-2">
<pre># MULTIPART-1
# message ID = h'0127c836722b55fafc7f196d7017a593
#                f09b500fee8dfe1dbf2071ee5f1caba7'
# timestamp  = not specified in example
[
  h'261c953e178af653fe3d42641b91d814', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires = never
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
                                         # partIndex = 0 (1st part)
    1,                                   # disposition = render
    "",                                  # language
    3,                                   # cardinality = multi
    0,                                   # partSemantics = chooseOne
    [
      [                                  # partIndex = 1
        1,                               # disposition = render
        "",                              # language
        1,                               # cardinality = single
        "text/markdown;variant=GFM-MIMI",# contentType
        '# Welcome!'                     # content
      ],
      [                                  # partIndex = 2
        1,                               # disposition = render
        "",                              # language
        1,                               # cardinality = single
        # contentType
        "application/vnd.examplevendor-fancy-im-message",
        # content
        h'dc861ebaa718fd7c3ca159f71a2001'
      ]
    ]
  ]
]

</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="multiple-reactions-example">
<section id="appendix-B.2">
        <h3 id="name-multiple-reactions-example">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-multiple-reactions-example" class="section-name selfRef">Multiple Reactions Example</a>
        </h3>
<p id="appendix-B.2-1">This example shows sending a reaction with multiple separate emojis.<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div class="lang-edn sourcecode" id="appendix-B.2-2">
<pre># MULTIPART-2
# message ID = h'014b0cc005052325622d14752517700a
#                38dd32b10225da8437c3fe5a2603c303'
# timestamp  = not specified in example
[
  h'8528dc2d92e4f1944d62042907ab94d0', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires = never
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
                                         # partIndex = 0 (1st part)
    2,                                   # disposition = reaction
    "",                                  # language
    3,                                   # cardinality = multi
    2,                                   # partSemantics = processAll
    [
      [                                  # partIndex = 1
        2,                               # disposition = reaction
        "",                              # language
        1,                               # cardinality = single
        "text/plain;charset=utf-8",      # contentType
        h'E2 9D A4'           # content = Unicode "heart"
      ],
      [                                  # partIndex = 2
        2,                               # disposition = reaction
        "",                              # language
        1,                               # cardinality = single
        "text/plain;charset=utf-8",      # contentType
        h'F0 9F A5 B3'        # content = Unicode "party face"
      ],
      [                                  # partIndex = 3
        2,                               # disposition = reaction
        "",                              # language
        1,                               # cardinality = single
        "text/plain;charset=utf-8",      # contentType
        h'F0 9F A4 9E'        # content = Unicode "fingers crossed"
      ]
    ]
  ]
]

</pre><a href="#appendix-B.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nesting-example">
<section id="appendix-B.3">
        <h3 id="name-complicated-nested-example">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-complicated-nested-example" class="section-name selfRef">Complicated Nested Example</a>
        </h3>
<p id="appendix-B.3-1">This example shows separate GIF and PNG inline images with English and
French versions of an HTML message. A summary of the 11 parts are shown below.<a href="#appendix-B.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-B.3-2">
<pre>Part  Description
 0    choose either GIF or PNG
 1      (with GIF) process all
 2        choose either English or French
 3          English
 4          French
 5        GIF
 6      (with PNG) process all
 7        choose either English or French
 8          English
 9          French
10        PNG

</pre><a href="#appendix-B.3-2" class="pilcrow">¶</a>
</div>
<div class="breakable lang-edn sourcecode" id="appendix-B.3-3">
<pre># MULTIPART-3
# message ID = h'0182a32b2593cc68ef1b00ed91cfe2dc
#                8db547636b6070b0f5ef8de7ae176523'
# timestamp  = not specified in example
[
  h'b8362793168d18c049b882d4642a2274', # salt
  null,                                # replaces
  h'',                                 # topicId
  null,                                # expires = never
  null,                                # inReplyTo
  {                                    # extensions
    1: "mimi://example.com/u/alice-smith",
    2: "mimi://example.com/r/engineering_team"
  },
  [                                    # body (NestedPart)
                                         # partIndex = 0 (1st part)
    1,                                   # disposition = render
    "",                                  # language
    3,                                   # cardinality = multi
    0,                                   # partSemantics = chooseOne
    [
      [                                  # partIndex = 1
        1,                               # disposition = render
        "",                              # language
        3,                               # cardinality = multi
        2,                               # partSemantics = processAll
        [
          [                              # partIndex = 2
            1,                           # disposition = render
            "",                          # language
            3,                           # cardinality = multi
            0,                           # partSemantics = chooseOne
            [
              [                          # partIndex = 3
                1,                       # disposition = render
                "en",                    # language
                1,                       # cardinality = single
                # content type
                "text/html;charset=utf-8",
                # content
                '&lt;html&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;\n' +
                '&lt;img src="cid:5@local.invalid" ' +
                'alt="Welcome image"/&gt;\n&lt;/body&gt;&lt;/html&gt;'
              ],       # English HTML
              [                          # partIndex = 4
                1,                       # disposition = render
                "fr",                    # language
                1,                       # cardinality = single
                # content type
                "text/html;charset=utf-8",
                # content
                '&lt;html&gt;&lt;body&gt;&lt;h1&gt;Bienvenue!&lt;/h1&gt;\n' +
                '&lt;img src="cid:5@local.invalid" ' +
                'alt="Image bienvenue"/&gt;\n&lt;/body&gt;&lt;/html&gt;'
              ]        # French HTML
            ]
          ],         # English or French HTML (refers to GIF)
          [                              # partIndex = 5
            4,                           # disposition = inline
            "",                          # language
            1,                           # cardinality = single
            "image/gif",                 # content type
            # content
            h'dc861ebaa718fd7c3ca159f71a2001a7'
          ]          # GIF
        ]
      ],           # GIF version with English or French HTML
      [                                  # partIndex = 6
        1,                               # disposition = render
        "",                              # language
        3,                               # cardinality = multi
        2,                               # partSemantics = processAll
        [
          [                              # partIndex = 7
            1,                           # disposition = render
            "",                          # language
            3,                           # cardinality = multi
            0,                           # partSemantics = chooseOne
            [
              [                          # partIndex = 8
                1,                       # disposition = render
                "en",                    # language
                1,                       # cardinality = single
                # content type
                "text/html;charset=utf-8",
                # content
                '&lt;html&gt;&lt;body&gt;&lt;h1&gt;Welcome!&lt;/h1&gt;\n' +
                '&lt;img src="cid:10@local.invalid" ' +
                'alt="Welcome image"/&gt;\n&lt;/body&gt;&lt;/html&gt;'
              ],       # English HTML
              [                         # partIndex = 9
                1,                      # disposition = render
                "fr",                   # language
                1,                      # cardinality = single
                # content type
                "text/html;charset=utf-8",
                # content
                '&lt;html&gt;&lt;body&gt;&lt;h1&gt;Bienvenue!&lt;/h1&gt;\n' +
                '&lt;img src="cid:10@local.invalid" ' +
                'alt="Image bienvenue"/&gt;\n&lt;/body&gt;&lt;/html&gt;'
              ]        # French HTML
            ]
          ],         # English or French HTML (refers to PNG)
          [                              # partIndex = 10
            4,                           # disposition = inline
            "",                          # language
            1,                           # cardinality = single
            "image/png",                 # content type
            # content
            h'fa444237451a05a72bb0f67037cc1669'
          ]          # PNG
        ]
      ]            # PNG version with English or French HTML
    ]            # GIF or PNG (with English or French HTML)
  ]
]

</pre><a href="#appendix-B.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="changelog">
<section id="appendix-C">
      <h2 id="name-changelog">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-changelog" class="section-name selfRef">Changelog</a>
      </h2>
<p id="appendix-C-1">RFC Editor, please remove this entire section.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<div id="changes-between-draft-mahy-mimi-content-01-and-draft-mahy-mimi-content-02">
<section id="appendix-C.1">
        <h3 id="name-changes-between-draft-mahy-">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-changes-between-draft-mahy-" class="section-name selfRef">Changes between draft-mahy-mimi-content-01 and draft-mahy-mimi-content-02</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.1-1.1">made semantics abstract (C++ structs) instead of using CPIM or MIME headers<a href="#appendix-C.1-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-mahy-mimi-content-02-and-draft-ietf-mimi-content-00">
<section id="appendix-C.2">
        <h3 id="name-changes-between-draft-mahy-m">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-changes-between-draft-mahy-m" class="section-name selfRef">Changes between draft-mahy-mimi-content-02 and draft-ietf-mimi-content-00</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.2-1.1">replaced threadId with topicId<a href="#appendix-C.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.2">inReplyTo now has a hash of the referenced message<a href="#appendix-C.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.3">clarified that replies are always to a specific version of a modified message<a href="#appendix-C.2-1.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.4">changed timestamp to a whole number of milliseconds since the epoch
to avoid confusion<a href="#appendix-C.2-1.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.5">added Security Considerations section<a href="#appendix-C.2-1.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.6">added IANA Considerations section<a href="#appendix-C.2-1.6" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.2-1.7">added change log<a href="#appendix-C.2-1.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-ietf-mimi-content-00-and-draft-ietf-mimi-content-01">
<section id="appendix-C.3">
        <h3 id="name-changes-between-draft-ietf-">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-changes-between-draft-ietf-" class="section-name selfRef">Changes between draft-ietf-mimi-content-00 and draft-ietf-mimi-content-01</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.3-1.1">created new abstract format for attachment information, instead of using
message/external-body<a href="#appendix-C.3-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.3-1.2">added discussion of encrypting external content<a href="#appendix-C.3-1.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.3-1.3">clarified the difference between <code>render</code> and <code>inline</code> dispositions<a href="#appendix-C.3-1.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.3-1.4">created a way for the messageId and timestamp to be shared in the MLS
additional authenticated data field<a href="#appendix-C.3-1.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.3-1.5">expanded discussion of what can and should be rendered when a mention is
encountered; discussed how to prevent confusion attacks with mentions.<a href="#appendix-C.3-1.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.3-1.6">added a lastSeen field used to ensure a more consistent sort order of
messages in a room.<a href="#appendix-C.3-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-ietf-mimi-content-01-and-draft-ietf-mimi-content-02">
<section id="appendix-C.4">
        <h3 id="name-changes-between-draft-ietf-m">
<a href="#appendix-C.4" class="section-number selfRef">C.4. </a><a href="#name-changes-between-draft-ietf-m" class="section-name selfRef">Changes between draft-ietf-mimi-content-01 and draft-ietf-mimi-content-02</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.4-1.1">consensus at IETF 118 was to use a hash of the ciphertext in lieu of the
message ID<a href="#appendix-C.4-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.4-1.2">consensus at IETF 118 was to use the hub accepted timestamp for protocol
actions like sorting<a href="#appendix-C.4-1.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.4-1.3">Updated author's address<a href="#appendix-C.4-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-ietf-mimi-content-02-and-draft-ietf-mimi-content-03">
<section id="appendix-C.5">
        <h3 id="name-changes-between-draft-ietf-mi">
<a href="#appendix-C.5" class="section-number selfRef">C.5. </a><a href="#name-changes-between-draft-ietf-mi" class="section-name selfRef">Changes between draft-ietf-mimi-content-02 and draft-ietf-mimi-content-03</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.5-1.1">added hash of content to external content<a href="#appendix-C.5-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.5-1.2">replaced abstract syntax with concrete TLS Presentation Language and CBOR syntaxes<a href="#appendix-C.5-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-ietf-mimi-content-03-and-draft-ietf-mimi-content-04">
<section id="appendix-C.6">
        <h3 id="name-changes-between-draft-ietf-mim">
<a href="#appendix-C.6" class="section-number selfRef">C.6. </a><a href="#name-changes-between-draft-ietf-mim" class="section-name selfRef">Changes between draft-ietf-mimi-content-03 and draft-ietf-mimi-content-04</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.6-1.1">use CBOR as the binary encoding<a href="#appendix-C.6-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.6-1.2">add multipart examples<a href="#appendix-C.6-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-mahy-mimi-content-04-and-draft-mahy-mimi-content-05">
<section id="appendix-C.7">
        <h3 id="name-changes-between-draft-mahy-mi">
<a href="#appendix-C.7" class="section-number selfRef">C.7. </a><a href="#name-changes-between-draft-mahy-mi" class="section-name selfRef">Changes between draft-mahy-mimi-content-04 and draft-mahy-mimi-content-05</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.7-1.1">change message ID construction, and add salt<a href="#appendix-C.7-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.2">remove partIndex and make it implied<a href="#appendix-C.7-1.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.3">mention Content ID URI (cid:) and describe using it with the implicit
partIndex<a href="#appendix-C.7-1.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.4">discuss rendering and authorization issues for edit/delete in the security
considerations<a href="#appendix-C.7-1.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.5">include both absolute and relative expiration times<a href="#appendix-C.7-1.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.6">add specificity about markdown support / create GFM-MIMI Markdown variant<a href="#appendix-C.7-1.6" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.7-1.7">remove tag from URLs in ExternalPart and implied headers<a href="#appendix-C.7-1.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="changes-between-draft-mahy-mimi-content-05-and-draft-mahy-mimi-content-06">
<section id="appendix-C.8">
        <h3 id="name-changes-between-draft-mahy-mim">
<a href="#appendix-C.8" class="section-number selfRef">C.8. </a><a href="#name-changes-between-draft-mahy-mim" class="section-name selfRef">Changes between draft-mahy-mimi-content-05 and draft-mahy-mimi-content-06</a>
        </h3>
<ul class="compact">
<li class="compact" id="appendix-C.8-1.1">remove lastSeen field<a href="#appendix-C.8-1.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.2">improve guidance on processing MultiPart with content ID URIs<a href="#appendix-C.8-1.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.3">add extra copy of the salt to Message ID construction to prevent SHA256 length extension attack<a href="#appendix-C.8-1.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.4">future-proof timestamp format hub timestamp<a href="#appendix-C.8-1.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.5">IANA register the MIMI extension keys used in the draft<a href="#appendix-C.8-1.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.6">lots of changes for internal consistency<a href="#appendix-C.8-1.6" class="pilcrow">¶</a>
</li>
          <li class="compact" id="appendix-C.8-1.7">rebuild all the examples from a script. make sure the EDN and CBOR correspond
and the CDDL validates the CBOR.<a href="#appendix-C.8-1.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rohan Mahy</span></div>
<div dir="auto" class="left"><span class="org">Rohan Mahy Consulting Services</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rohan.ietf@gmail.com" class="email">rohan.ietf@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
